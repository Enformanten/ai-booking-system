
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-8.5.10">
    
    
      
        <title>Print Site - Thermo</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.2505c338.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/print-site-enum-headings1.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings2.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings3.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings4.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings5.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings6.css">
    
      <link rel="stylesheet" href="../css/print-site.css">
    
      <link rel="stylesheet" href="../css/print-site-material.css">
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("/",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  
        <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function () {
            remove_material_navigation();remove_mkdocs_theme_navigation();generate_toc();
        })
        </script>
        </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Thermo" class="md-header__button md-logo" aria-label="Thermo" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Thermo
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Print Site
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
          
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/NTTDATAInnovation/thermo" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Thermo" class="md-nav__button md-logo" aria-label="Thermo" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Thermo
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/NTTDATAInnovation/thermo" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Machine Learning
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Machine Learning" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Machine Learning
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ml/usage/" class="md-nav__link">
        Usage
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ml/workflow/" class="md-nav__link">
        Description
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ml/dev/" class="md-nav__link">
        Development
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Principles behind the code
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Principles behind the code" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Principles behind the code
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../thermo/" class="md-nav__link">
        The heat equation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../graph/" class="md-nav__link">
        School as a graph
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../capacity/" class="md-nav__link">
        Model for capacity
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ref/recommender/" class="md-nav__link">
        Recommender and Recommendation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ref/ranker/" class="md-nav__link">
        Rankers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ref/cost/" class="md-nav__link">
        Costs
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_4" type="checkbox" id="__nav_4_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_4">
          Machine Learning workflow
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Machine Learning workflow" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_4">
          <span class="md-nav__icon md-icon"></span>
          Machine Learning workflow
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ref/ml/get_data/" class="md-nav__link">
        get_data.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ref/ml/preprocessing/" class="md-nav__link">
        preprocessing.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ref/ml/train/" class="md-nav__link">
        train.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ref/ml/evaluate/" class="md-nav__link">
        evaluate_model.py
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#" class="md-nav__link">
    1. Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-machine-learning" class="md-nav__link">
    I. Machine Learning
  </a>
  
    <nav class="md-nav" aria-label="I. Machine Learning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ml-usage" class="md-nav__link">
    2. Usage
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ml-workflow" class="md-nav__link">
    3. Description
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ml-dev" class="md-nav__link">
    4. Development
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-principles-behind-the-code" class="md-nav__link">
    II. Principles behind the code
  </a>
  
    <nav class="md-nav" aria-label="II. Principles behind the code">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#thermo" class="md-nav__link">
    5. The heat equation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#graph" class="md-nav__link">
    6. School as a graph
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#capacity" class="md-nav__link">
    7. Model for capacity
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-reference" class="md-nav__link">
    III. Reference
  </a>
  
    <nav class="md-nav" aria-label="III. Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ref-recommender" class="md-nav__link">
    8. Recommender and Recommendation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ref-ranker" class="md-nav__link">
    9. Rankers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ref-cost" class="md-nav__link">
    10. Costs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                




                  


<div id="print-site-page" class="print-site-enumerate-headings print-site-enumerate-figures">
        <section id="print-site-cover-page">
            
    <h1>Thermo</h1>

<h2>GovTech Smart M2 AI</h2>
<h3>Smart booking recommendations for energy optimization</h3>
        </section>
        
        <section class="print-page">
            <div id="print-page-toc" data-toc-depth="3">
                <nav role='navigation' class='print-page-toc-nav'>
                <h1 class='print-page-toc-title'>Table of Contents</h1>
                </nav>
            </div>
        </section>
        <section class="print-page" id="index"><h1 id="index-thermo">Thermo</h1>
<p><strong>Booking recommender system for energy optimization for the GovTech Smart M<sup>2</sup> OPI project.</strong></p>
<h3 id="index-background">Background</h3>
<p>The purpose of the OPI project is to achieve savings on energy and climate consumption by consolidating activities, implementing intelligent local allocation, and increasing the utilization rate of the municipal building stock through the use of building data, IoT solutions (Internet of Things), and artificial intelligence (AI).</p>
<p>The municipalities wish to carry out a public-private innovation collaboration with NTT DATA, in which the municipalities, together with NTT DATA, investigate, test, and specify which components and processes are necessary, regardless of the choice of supplier, for a later solution in a nationwide tender, which focuses on providing insight and overview of energy consumption at the three selected primary schools, and to develop the solution as an AI solution for optimizing energy consumption outside of normal school hours, from 4pm to 10pm on weekdays and during the weekends. Daytime hours are not included in local optimization as it is not possible to extract data from AULA, and because it would exceed the project's economic framework to rely on a solution that can retrieve data from AULA through alternative means.</p>
<h3 id="index-project-objectives">Project objectives</h3>
<ul>
<li>To provide users with an overview of possible bookings for a given building, ranked by estimated energy optimality.</li>
<li>To use existing data sources to estimate the energy cost associated with possible bookings, including:<ul>
<li>Building plan (room location relative to other rooms)</li>
<li>Room capacity and inherent functionalities (whiteboard, kitchen equipment, etc.)</li>
<li>Indoor climate</li>
<li>Energy consumption</li>
</ul>
</li>
<li>To identify the necessary data sources to build this type of AI solution.</li>
</ul>
<h3 id="index-users">Users</h3>
<ul>
<li>Building managers (professionals responsible for booking rooms on behalf of leisure users and/or monitoring and controlling CTS operation).</li>
<li>Leisure users (third-party users who want to book a room in the given building).</li>
</ul>
<h3 id="index-use-case">Use case</h3>
<p>(What actions should be possible via the AI solution?)
(In the following, it is assumed that the AI solution is connected to a web-based application with a GUI)
- Retrieve/see a ranked list of estimated climate-optimal bookings for a given building at the given time.</p>
<h3 id="index-demo-gui">Demo GUI</h3>
<p>A GUI (built in streamlit) is available @ https://app-govtech-demo.azurewebsites.net/
<strong>NOTE</strong>: May be taken down during/after the project.</p>
<p><br></p>
<hr />
<p><br></p>
<h2 id="index-example-usage">Example usage</h2>
<p>(Installation guide is excluded from this public documentation.)
Building specifications are loaded from a config directory, through the <code>.from_config</code> method. The booking state is retrieved under the hood through an open API.</p>
<p><div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#index-__codelineno-0-1"></a><span class="kn">from</span> <span class="nn">thermo.recommender</span> <span class="kn">import</span> <span class="n">Recommender</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#index-__codelineno-0-2"></a><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#index-__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#index-__codelineno-0-4"></a><span class="n">recommender</span> <span class="o">=</span> <span class="n">Recommender</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span><span class="n">building_name</span> <span class="o">=</span> <span class="s2">&quot;demo_school&quot;</span><span class="p">)</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#index-__codelineno-0-5"></a><span class="n">recommendation</span> <span class="o">=</span> <span class="n">recommender</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">day</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">())</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#index-__codelineno-0-6"></a>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#index-__codelineno-0-7"></a><span class="n">recommendation</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></code></pre></div>
<code>show()</code> returns a color-coded DataFrame.Styler object, similar to the following table</p>
<p><br></p>
<table>
<thead>
<tr>
<th style="text-align: center;"></th>
<th style="text-align: center;">Room A</th>
<th style="text-align: center;">...</th>
<th style="text-align: center;">Room G</th>
<th style="text-align: center;">Room H</th>
<th style="text-align: center;">Room I</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">t_0</td>
<td style="text-align: center;">1.0</td>
<td style="text-align: center;">...</td>
<td style="text-align: center;">1.0</td>
<td style="text-align: center;">1.0</td>
<td style="text-align: center;">0.5</td>
</tr>
<tr>
<td style="text-align: center;">t_1</td>
<td style="text-align: center;">1.0</td>
<td style="text-align: center;">...</td>
<td style="text-align: center;">1.0</td>
<td style="text-align: center;">0.5</td>
<td style="text-align: center;"></td>
</tr>
<tr>
<td style="text-align: center;">t_2</td>
<td style="text-align: center;">1.0</td>
<td style="text-align: center;">...</td>
<td style="text-align: center;">1.0</td>
<td style="text-align: center;">1.0</td>
<td style="text-align: center;">0.0</td>
</tr>
<tr>
<td style="text-align: center;">t_3</td>
<td style="text-align: center;">1.0</td>
<td style="text-align: center;">...</td>
<td style="text-align: center;">1.0</td>
<td style="text-align: center;">0.5</td>
<td style="text-align: center;"></td>
</tr>
<tr>
<td style="text-align: center;">t_4</td>
<td style="text-align: center;">1.0</td>
<td style="text-align: center;">...</td>
<td style="text-align: center;">1.0</td>
<td style="text-align: center;">1.0</td>
<td style="text-align: center;">0.5</td>
</tr>
<tr>
<td style="text-align: center;">t_5</td>
<td style="text-align: center;">0.5</td>
<td style="text-align: center;">...</td>
<td style="text-align: center;">0.5</td>
<td style="text-align: center;">1.0</td>
<td style="text-align: center;">1.0</td>
</tr>
<tr>
<td style="text-align: center;">t_6</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">...</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">0.5</td>
<td style="text-align: center;">1.0</td>
</tr>
<tr>
<td style="text-align: center;">t_7</td>
<td style="text-align: center;">0.0</td>
<td style="text-align: center;">...</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">1.0</td>
<td style="text-align: center;">1.0</td>
</tr>
</tbody>
</table>
<p><br></p>
<p>With the empty cells representing time slots that are either already booked or infeasible due to the booking requirements (e.g., required capacity or particular amenities such as a whiteboard)</p>
<p>Similarly, <code>recommendation.top_recommendations()</code> produces a list of room-time combinations, i.e. booking recommendations, ranked after their aggregated (estimated) cost (<em>score</em>).</p>
<table>
<thead>
<tr>
<th style="text-align: center;">Time Slot</th>
<th style="text-align: center;">Room</th>
<th style="text-align: center;">Score</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">t_2</td>
<td style="text-align: center;">Room I</td>
<td style="text-align: center;">0.0</td>
</tr>
<tr>
<td style="text-align: center;">t_7</td>
<td style="text-align: center;">Room E</td>
<td style="text-align: center;">0.0</td>
</tr>
<tr>
<td style="text-align: center;">t_0</td>
<td style="text-align: center;">Room I</td>
<td style="text-align: center;">0.5</td>
</tr>
<tr>
<td style="text-align: center;">t_1</td>
<td style="text-align: center;">Room H</td>
<td style="text-align: center;">0.5</td>
</tr>
<tr>
<td style="text-align: center;">t_3</td>
<td style="text-align: center;">Room H</td>
<td style="text-align: center;">0.5</td>
</tr>
<tr>
<td style="text-align: center;">...</td>
<td style="text-align: center;">...</td>
<td style="text-align: center;">...</td>
</tr>
<tr>
<td style="text-align: center;">t_7</td>
<td style="text-align: center;">Room F</td>
<td style="text-align: center;">1.0</td>
</tr>
</tbody>
</table>
<p><br></p>
<h3 id="index-user-arguments">User arguments</h3>
<p>User arguments (i.e. booking requirements) are passed to the <code>.run</code> function of the <code>Recommender</code>.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#index-__codelineno-1-1"></a><span class="n">recommendation</span> <span class="o">=</span> <span class="n">recommender</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#index-__codelineno-1-2"></a>    <span class="n">recommender</span><span class="o">=</span><span class="n">recommender</span><span class="p">,</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#index-__codelineno-1-3"></a>    <span class="n">day</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">(),</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#index-__codelineno-1-4"></a>    <span class="n">required_amenities</span><span class="o">=</span><span class="n">REQUIRED_AMENITIES</span><span class="p">,</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#index-__codelineno-1-5"></a>    <span class="o">...</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#index-__codelineno-1-6"></a>    <span class="n">required_capacity</span><span class="o">=</span><span class="n">REQUIRED_CAPACITY</span><span class="p">,</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#index-__codelineno-1-7"></a><span class="p">)</span>
</span></code></pre></div></section>
                        <h1 class='nav-section-title' id='section-machine-learning'>
                            Machine Learning <a class='headerlink' href='#section-machine-learning' title='Permanent link'>â†µ</a>
                        </h1>
                        <section class="print-page" id="ml-usage"><h1 id="ml-usage-using-the-ml-pipelines">Using the ML pipelines</h1>
<h2 id="ml-usage-setup">Setup</h2>
<p>This project uses <a href="https://dvc.org/">DVC</a> (Data Version Control) for the version control of datasets and machine learning models, as well as for organizing machine learning pipelines and workflows.</p>
<p>In order to use it, it is necessary to install <a href="https://nttdatainnovation.github.io/thermo/">thermo</a> with its <em>development</em> dependencies:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ml-usage-__codelineno-0-1"></a>poetry<span class="w"> </span>install<span class="w"> </span>--with<span class="w"> </span>dev
</span></code></pre></div></p>
<h2 id="ml-usage-running-an-existing-pipeline">Running an existing pipeline</h2>
<p>To create a model to extract hyperparameters for a given building run the following:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ml-usage-__codelineno-1-1"></a><span class="nb">cd</span><span class="w"> </span>buildings/&lt;building_name&gt;
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#ml-usage-__codelineno-1-2"></a>dvc<span class="w"> </span>exp<span class="w"> </span>run<span class="w"> </span>dvc.yaml
</span></code></pre></div></p>
<p>For example, for <strong>Strandskolen</strong> in <strong>Aarhus kommune</strong> this would be:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ml-usage-__codelineno-2-1"></a><span class="nb">cd</span><span class="w"> </span>buildings/strandskolen
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#ml-usage-__codelineno-2-2"></a>dvc<span class="w"> </span>exp<span class="w"> </span>run<span class="w"> </span>dvc.yaml
</span></code></pre></div></p>
<h3 id="ml-usage-troubleshooting">Troubleshooting</h3>
<p>Make sure to store that the source data is stored in the <code>assets</code> directory into <code>csv</code> files, so that the pipeline is able to find them.</p>
<p>You might need to indicate to the pipeline the name and the contents of the original files. This can be done by modifying the <code>params.yaml</code> file in the <code>building/&lt;building_name&gt;</code> folder.</p></section><section class="print-page" id="ml-workflow"><h1 id="ml-workflow-description-of-the-workflow-and-its-components">Description of the workflow and its components:</h1>
<p>The machine learning workflow is described by the <code>dvc.yaml</code> file under each building folder. For example, the workflow for te <code>demo_school</code> is <code>buildings/demo_school/dvc.yaml</code>.</p>
<p>Each machine learning workflow is split into several steps that are executed sequentially, as illustrated by the following graph:</p>
<p align="center">
  <img src="../assets/diagram.drawio.svg" alt="Workflow"/>
</p>

<p>Each step executes a python script, which can be found under <code>thermo/stages</code> passing a set of parameters specific for that building, stored in the <code>params.yml</code> file (<code>buildings/&lt;building_name&gt;/params.yaml</code>) and produces some files that are stored under the <code>data/</code> or <code>model/</code> folder (<code>buildings/&lt;building_name&gt;/data</code> and <code>buildings/&lt;building_name&gt;/model</code>).</p>
<p>In the following we describe the content of each script and what the parameters involved are. The specifics on how it works can be found in the API reference of this documentation.</p>
<h2 id="ml-workflow-get-data">Get data</h2>
<p>This script takes data from different data sources, stored as <code>csv</code> files under <code>assets/</code>, selects the relevant subset of data.
This involves things like the specific <em>building</em>, the <em>year</em> or the <em>measure_point</em> for the energy sources. It then formats the data into a row per time stamp with a column per room and add columns with energy information.</p>
<h4 id="ml-workflow-takes-in">Takes in:</h4>
<ul>
<li><code>.csv</code> files under <code>assets</code></li>
</ul>
<h4 id="ml-workflow-outputs">Outputs:</h4>
<ul>
<li><code>raw_data.pkl</code> under the <code>data/</code> folder for the building</li>
</ul>
<h4 id="ml-workflow-parameters">Parameters:</h4>
<p><div class="language-yaml highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ml-workflow-__codelineno-0-1"></a><span class="c1">## General parameters for the workflow</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#ml-workflow-__codelineno-0-2"></a>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#ml-workflow-__codelineno-0-3"></a><span class="nt">building</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">demo_school</span><span class="w">  </span><span class="c1"># name of the building as in the data file</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#ml-workflow-__codelineno-0-4"></a><span class="nt">municipality</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">demo_municipality</span><span class="w">   </span><span class="c1"># name of the municipality as in the data file</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#ml-workflow-__codelineno-0-5"></a><span class="nt">year</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2022</span><span class="w">  </span><span class="c1"># year of the dataset used</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#ml-workflow-__codelineno-0-6"></a>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#ml-workflow-__codelineno-0-7"></a><span class="c1">## Parameters specific to get_data.py step</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#ml-workflow-__codelineno-0-8"></a><span class="nt">get_data</span><span class="p">:</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#ml-workflow-__codelineno-0-9"></a><span class="w">    </span><span class="nt">files</span><span class="p">:</span><span class="w">  </span><span class="c1"># list of files with data. Each must contain a name, filepath and parse_params</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#ml-workflow-__codelineno-0-10"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bookings</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#ml-workflow-__codelineno-0-11"></a><span class="w">          </span><span class="nt">file_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assets/demo_bookings.csv</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#ml-workflow-__codelineno-0-12"></a><span class="w">          </span><span class="nt">parse_params</span><span class="p">:</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#ml-workflow-__codelineno-0-13"></a><span class="w">            </span><span class="nt">drop_empty_rooms</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#ml-workflow-__codelineno-0-14"></a><span class="w">            </span><span class="nt">aggregation_method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">binary</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#ml-workflow-__codelineno-0-15"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">energy</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#ml-workflow-__codelineno-0-16"></a><span class="w">          </span><span class="nt">file_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assets/demo_energy.csv</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#ml-workflow-__codelineno-0-17"></a><span class="w">          </span><span class="nt">parse_params</span><span class="p">:</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#ml-workflow-__codelineno-0-18"></a><span class="w">            </span><span class="nt">measure_points</span><span class="p">:</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#ml-workflow-__codelineno-0-19"></a><span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">12892834</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#ml-workflow-__codelineno-0-20"></a><span class="w">            </span><span class="nt">measure_types</span><span class="p">:</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#ml-workflow-__codelineno-0-21"></a><span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">electricity</span>
</span></code></pre></div>
Files in <code>params.yaml</code> for <code>get_data</code> must be described by a <strong>name</strong>, a <strong>filepath</strong> and a <strong>parse_params</strong> "dictionary" with the parameters to parse.</p>
<ul>
<li><strong>name</strong>: The type of information in the file, currently only <strong>bookings</strong> and <strong>energy</strong> are implemented.</li>
<li><strong>file_path</strong>: Path to the <code>csv</code> file containing the data relative to the main directory of the repository.</li>
<li><strong>parse_params</strong>: additional parameters to parse the file. These parameters will depend on the type of file.<ul>
<li><em>parse_params</em> for <em>bookings</em> files:<ul>
<li><code>drop_empty_rooms</code>: boolean. Weather to create columns for rooms that have never been booked or not.</li>
<li><code>aggregation_method</code>: This can be <code>binary</code> or <code>fractional</code>. Binary will assign 1 if the room was booked and 0 otherwise. Fractional will assign the percentage of the time slot during which the rooms was booked (fx: if the room was booked between 17:30 and 18:00, it will assign 0.5 to the that room for the time slot 17:00-18:00)</li>
</ul>
</li>
<li><em>parse_params</em> for <em>energy</em> files:<ul>
<li><code>measure_points</code>: List of measure points whose energy measure is included in the ML dataset.</li>
<li><code>measure_type</code>: Type of measurement (electricty, water, ...) as spelled in the dataset.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="ml-workflow-preprocessing">Preprocessing</h2>
<p>This script takes care of the feature engineering: it produces the insights we know are there so they can be fed to the machine learning algorithm in the next step.</p>
<p>It takes in the raw bookings and does two main tasks:
- Drops data that is not interesting
- Feature engineering: simulates the ventilation system.</p>
<h4 id="ml-workflow-takes-in_1">Takes in:</h4>
<ul>
<li><code>raw_data.pkl</code> under the <code>data/</code> folder for the building</li>
</ul>
<h4 id="ml-workflow-outputs_1">Outputs:</h4>
<ul>
<li><code>preprocessed_data.pkl</code> under the <code>data/</code> folder for the building</li>
</ul>
<h4 id="ml-workflow-parameters_1">Parameters:</h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ml-workflow-__codelineno-1-1"></a><span class="c1">## Parameters specific to preprocessing.py step</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#ml-workflow-__codelineno-1-2"></a><span class="nt">preprocessing</span><span class="p">:</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#ml-workflow-__codelineno-1-3"></a><span class="w">  </span><span class="nt">booking_hours_threshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#ml-workflow-__codelineno-1-4"></a><span class="w">  </span><span class="nt">drop_nights_and_school_hours</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#ml-workflow-__codelineno-1-5"></a><span class="w">  </span><span class="nt">ventilation</span><span class="p">:</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#ml-workflow-__codelineno-1-6"></a><span class="w">    </span><span class="nt">is_day</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span></code></pre></div>
<ul>
<li><code>booking_hours_threshold</code> (int): rooms that have been booked less hours than this threshold will be dropped by the pipeline.</li>
<li><code>drop_nights_and_school_hours</code> (bool): If <code>True</code> drops the hours between midnight and the start of the booking period (this hour is defined in <code>thermo/config.py</code>)</li>
<li><code>mock_ventilation</code>: can be <code>is_day:True</code> or <code>is_on:True</code>:<ul>
<li><code>is_on:True</code> results in one hot encoding of
whether the ventilation is on
<code>is_day:True</code> results
in a distinction between if the room was booked or it wasn't
but the ventilation is in day mode.</li>
</ul>
</li>
</ul>
<h2 id="ml-workflow-train">Train</h2>
<p>Train a linear regression to extract the cost of booking each room from the data. The model is trained using n-fold cross validation and grid search to decide the value of the <span class="arithmatex">\(\ell_2\)</span> regularization( see documentation for <a href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.Ridge.html">ridge regression</a>) that best fits the data.</p>
<h4 id="ml-workflow-takes-in_2">Takes in:</h4>
<ul>
<li><code>preprocessed_data.pkl</code> under the <code>data/</code> folder for the building</li>
</ul>
<h4 id="ml-workflow-outputs_2">Outputs:</h4>
<ul>
<li><code>model/model.joblib</code>: File containing the model, makes it possible to use it to predict things later.</li>
<li><code>model/model.metadata</code>: Summary of the model chosen using cross-validation. Human readable.</li>
<li><code>model/cross_validation.csv</code>: Table with the full information about all cross-validation experiments.</li>
</ul>
<h4 id="ml-workflow-parameters_2">Parameters:</h4>
<p><div class="language-yaml highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ml-workflow-__codelineno-2-1"></a><span class="c1">## Parameters specific to preprocessing.py step</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#ml-workflow-__codelineno-2-2"></a><span class="nt">train</span><span class="p">:</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#ml-workflow-__codelineno-2-3"></a><span class="w">  </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">electricity</span><span class="w">   </span><span class="c1"># name of the target variable</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#ml-workflow-__codelineno-2-4"></a><span class="w">  </span><span class="nt">estimator</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RidgeRegression</span><span class="w">  </span><span class="c1"># name of the regression algorithm</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#ml-workflow-__codelineno-2-5"></a><span class="w">  </span><span class="nt">cv_folds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span><span class="w">  </span><span class="c1"># number of cross validation folds</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#ml-workflow-__codelineno-2-6"></a><span class="w">  </span><span class="nt">alpha_min</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.01</span><span class="w">  </span><span class="c1"># min L2 regularization for grid search</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#ml-workflow-__codelineno-2-7"></a><span class="w">  </span><span class="nt">alpha_max</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span><span class="w">   </span><span class="c1"># max L2 regularization for grid search</span>
</span></code></pre></div>
<strong>Note</strong>: Currently, only <code>RidgeRegression</code> is supported as estimator.</p>
<h2 id="ml-workflow-evaluate_model">Evaluate_model</h2>
<p>This script validates the results of the rest of the workflow and produces plots and charts so that the quality can be further evaluated by the user.</p>
<p>It doesn't take any parameters.</p>
<h4 id="ml-workflow-takes-in_3">Takes in:</h4>
<ul>
<li><code>preprocessed_data.pkl</code> under the <code>data/</code> folder for the building</li>
<li><code>model/model.joblib</code>: File containing the model, makes it possible to use it to predict things later.</li>
<li><code>model/cross_validation.csv</code>: Table with the full information about all cross-validation experiments.</li>
</ul>
<h4 id="ml-workflow-outputs_3">Outputs:</h4>
<ul>
<li><code>model/train.json</code> &amp; <code>model/test.json</code>: Train and test metrics (<span class="arithmatex">\(r^2\)</span>  and RMSE) for the optimal hyperparameters, as averaged over cross validation folds.</li>
<li><code>model/costs.csv</code> - Extracts the costs of heating and keeping warm the rooms of the building and validates the result.</li>
<li><code>model/error_distribution.png</code>- plots the error distribution of the fit. The prediction for all points is the test set prediction from fold where that point was in the test set.  Here is the result on the demo data set.</li>
</ul>
<p><img _="," align="left" alt="error_distribution" src="../assets/error_distribution.png" width="400" /></p>
<ul>
<li><code>model/regularization.png</code>: plot of the result of the grid search for the regularization.</li>
</ul></section><section class="print-page" id="ml-dev"><h1 id="ml-dev-development-information-for-ml-pipelines">Development information for ML pipelines</h1>
<h2 id="ml-dev-creating-a-new-pipeline-for-a-new-building-school">Creating a new pipeline for a new building / school:</h2>
<p>If you would like to add a machine learning model for a new school, you should do the following:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ml-dev-__codelineno-0-1"></a>mkdir<span class="w"> </span>buildings/&lt;building_name&gt;<span class="w">  </span><span class="c1"># This creates the directory, skip it if you already have one</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#ml-dev-__codelineno-0-2"></a><span class="nb">cd</span><span class="w"> </span>buildings/&lt;building_name&gt;
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#ml-dev-__codelineno-0-3"></a>dvc<span class="w"> </span>init<span class="w"> </span>--subdir
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#ml-dev-__codelineno-0-4"></a>git<span class="w"> </span>add<span class="w"> </span>.
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#ml-dev-__codelineno-0-5"></a>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Add dvc tracking for school &lt;building_name&gt;&quot;</span>
</span></code></pre></div>
<p>This will create a DVC project for the school and commit al the DVC metafiles and directories. You can read more on this <a href="https://dvc.org/doc/user-guide/basic-concepts/dvc-project">here</a>.</p>
<p>After this, one needs a <code>dvc.yaml</code> and a <code>params.yaml</code> file in the <code>buildings/&lt;building_name&gt;</code> folder. We recommend copying the files in <code>demo_school</code></p>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ml-dev-__codelineno-1-1"></a>cp<span class="w"> </span>buildings/demo_school/dvc.yaml<span class="w"> </span>buildings/&lt;building_name&gt;
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#ml-dev-__codelineno-1-2"></a>cp<span class="w"> </span>buildings/demo_school/params.yaml<span class="w"> </span>buildings/&lt;building_name&gt;
</span></code></pre></div>
into the folder for the new building and modifying the <code>params.yaml</code> to fulfill your needs (In particular, to find the appropriate data source files under <code>assets/</code>).</p>
<p>Then, running
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ml-dev-__codelineno-2-1"></a><span class="nb">cd</span><span class="w"> </span>buildings/&lt;building_name&gt;<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>dvc<span class="w"> </span>exp<span class="w"> </span>run<span class="w"> </span>dvc.yaml
</span></code></pre></div>
will run the ML pipeline and you will be able to explore the results by examining the files created under:
<code>buildings/&lt;building_name&gt;/model/</code></p>
<h2 id="ml-dev-testing">Testing:</h2>
<p>The GitHub repository for <a href="https://nttdatainnovation.github.io/thermo/">thermo</a> includes a number of tests to ensure the quality of the ML pipelines.</p>
<h3 id="ml-dev-unit-tests">Unit tests:</h3>
<p>Unit tests have been written to ensure the integrity of the different components of the pipeline. They can be found <a href="https://github.com/NTTDATAInnovation/thermo/tree/main/tests/unit_tests/test_stages">here</a>. These tests are run, together with the other unit tests of the project, as part of the <code>testing/pytest</code> job every time code is pushed to the repository.</p>
<h3 id="ml-dev-intergrity-test-for-all-pipelines">Intergrity test for all pipelines:</h3>
<p>The job <code>testing/test_dvc</code> is run every time a <strong>pull request</strong> is opened in this repository. This component does a <strong>dry run</strong> of all the <code>dvc</code> pipelines under <code>buildings</code>, that is: <code>bulidings/*/dvc.yaml</code>.</p>
<p>This checks that the pipeline files are understandable to <code>dvc</code> themselves, but does not ensure that they run with no errors (that will depend on the data, among other things).</p>
<h3 id="ml-dev-ml-integration-tests">ML integration tests:</h3>
<p>ML integration tests check that the quality of results of the DVC pipeline for <em>demo-school</em>. As such, they need the files the pipeline generates. They are marked with <code>ml_integration</code> and they don't run unless they are specifically called for.</p>
<p>The code for the ml_integration tests can be found under <code>tests/integration_tests/test_mlworkflow</code>.</p>
<h4 id="ml-dev-running-ml-integration-tests-locally">Running ML integration tests locally</h4>
<p>First, you will need to run the <code>demo_school</code> pipeline, as:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ml-dev-__codelineno-3-1"></a><span class="nb">cd</span><span class="w"> </span>buildings/demo_school/
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#ml-dev-__codelineno-3-2"></a>dvc<span class="w"> </span>exp<span class="w"> </span>run<span class="w"> </span>dvc.yaml
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#ml-dev-__codelineno-3-3"></a><span class="nb">cd</span><span class="w"> </span>../..
</span></code></pre></div>
This will generate the files in the folders <code>buildings/demo_school/data</code> and <code>buildings/demo_school/model</code> that the integration tests need.</p>
<p>Then you can run the test as:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#ml-dev-__codelineno-4-1"></a>pytest<span class="w"> </span>-m<span class="w"> </span>ml_integration
</span></code></pre></div></p>
<h4 id="ml-dev-running-the-ml_integration-tests-in-github-actions">Running the ml_integration tests in GitHub Actions:</h4>
<p>The ML integration tests are run automatically every time a pull request is opened, if the dvc integrity tests complete.
The job first runs the <code>demo_school</code> dvc pipeline and then runs the tests marked as <code>ml_integration</code>.</p></section><h1 class='nav-section-title-end'>Ended: Machine Learning</h1>
                        <h1 class='nav-section-title' id='section-principles-behind-the-code'>
                            Principles behind the code <a class='headerlink' href='#section-principles-behind-the-code' title='Permanent link'>â†µ</a>
                        </h1>
                        <section class="print-page" id="thermo"><h1 id="thermo-thermal-diffusivity">Thermal diffusivity</h1>
<p>We use a thermal diffusion model to simulate the heat transfer between rooms and to the outside of a school.
We assume that the school and its internal walls are well insulated compared to the thermal conductivity of air,
this is, we assume that the temperature in a room is almost constant with respect to the position inside it.</p>
<p>We know there will be radiation effects (this is, rooms facing south will be warmer than rooms facing north when the
heating is off) but we haven't taken them into account.</p>
<p>We know there will be convection effects (this is, heat losses due to air currents), both from humans opening and
closing the windows (but this we will never be able to model, at least not without extra information) and from
the compulsory ventilation of the building. We haven't included a convection term, since it would make the simulation
quite challenging, and we hope that the thermal loss due to built-in ventilation can be assimilated to diffusion losses
through walls.</p>
<p>We assume the school has some sort of automation built in for the heaters, so that they are able to turn on
when there is a lecture and turn off when the room is not being used. Note we haven't done a full study of how a proper
controller would work, since we haven't considered retrofitting effects into the controller.</p>
<p>We have not considered other sources of heat, such as the people in the room, the light bulbs for illumination or the computers.
Thus, we assume that the room is relatively "large" compared to the number of people "crammed" in. We can come back to this later,
since it may have some impact in the optimization.</p>
<p>These considerations result in a linear inhomogeneous system of ordinary differential equations. Even though we know it would
be possible to transform the problem to the Laplace space to get a system of linear algebraic equations instead and then
transform back, making the module less computationally expensive, we have chosen not to do so for the moment. Instead, we
choose to use a Runge-Kutta method, as implemented in scipy. This implementation is more intuitive and easier to extend,
so we keep it for now. The same applies to the integral to calculate the the cumulative energy: we have used a Simpson method
because it is more flexible but if it became a bottleneck, we could use a Romberg method (they are both implemented in scipy).</p></section><section class="print-page" id="graph"><h1 id="graph-school-as-a-graph">School as a graph</h1>
<p><em>Sprint 3 - AI version 1</em></p>
<p>Let every school be represented by one or more graphs, where each node represents a room in the school. In this representation, two rooms share an edge if they share a wall (or a floor-ceiling in case of the school having more than one floor).</p>
<p>In this version, we represent the school as an undirected and unweighted graph, <span class="arithmatex">\(G_s\)</span>. If the graph can be split into several subgraphs, we choose this representation. From here on we assume, for the sake of clarity, that the school is represented by a single, indivisible graph, but the discussion may be extended to multiple graphs in later versions.</p>
<p>Let <span class="arithmatex">\(N_r\)</span> be the number of rooms in the school and let <span class="arithmatex">\(i=0, 1, ..., N_r-1\)</span> denote the <span class="arithmatex">\(i\)</span>-th room of the school. Then, the <em>adjacency matrix</em> <span class="arithmatex">\(A_s\)</span> of the school is given by:</p>
<div class="arithmatex">\[
    \left( A_s\right)_{ij} =
    \begin{cases}
1 &amp; \text{if } i \text{ and } j \text{ share a wall}, \\
0 &amp; \text{otherwise}.
\end{cases}
\]</div>
<h2 id="graph-the-booking-system-as-a-graph">The booking system as a graph</h2>
<p>We also represent the booking system as a graph <span class="arithmatex">\(G\)</span>, with <span class="arithmatex">\(N_r \times N_t\)</span> nodes, where <span class="arithmatex">\(N_t\)</span> is the number of time slots for a day. The graph <span class="arithmatex">\(G\)</span> consists of <span class="arithmatex">\(N_t\)</span> copies of the graph <span class="arithmatex">\(G_s\)</span>, where each copy represents the rooms of the school at a given time slot. Each room is connected to the rooms it shares a wall with, plus to the version of itself in the graphs representing the time-slots that take place immediately before and immediately after.</p>
<p>The adjacency matrix for graph <span class="arithmatex">\(G\)</span>, <span class="arithmatex">\(A\)</span>, is a squared matrix of size <span class="arithmatex">\(N_t N_r \times N_t N_r\)</span> that can be built in block form as follows:</p>
<div class="arithmatex">\[
A = \left(\begin{matrix}
A_s &amp; \lambda\mathbb{I} &amp; \mathbb{O} &amp;\cdots &amp; \mathbb{O} \\
\lambda\mathbb{I} &amp; A_s &amp; \lambda\mathbb{I} &amp; \cdots &amp; \mathbb{O} \\
\mathbb{O} &amp; \lambda\mathbb{I} &amp; A_s  &amp; \cdots &amp; \mathbb{O} \\
\vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
\mathbb{O} &amp; \mathbb{O} &amp; \mathbb{O} &amp;\cdots &amp; A_s\\
\end{matrix} \right),
\]</div>
<p>where all blocks are of size <span class="arithmatex">\(N_r \times N_r\)</span>,  <span class="arithmatex">\(\mathbb{I}\)</span> is the <em>identity matrix</em>, <span class="arithmatex">\(\mathbb{O}\)</span> is the <em>null matrix</em> and and <span class="arithmatex">\(\lambda\)</span> is a scalar coefficient representing the relative importance of time respect to space (more about this in the next section).</p>
<h2 id="graph-graph-based-first-order-model-for-the-cost-of-heating-rooms">Graph-based first-order model for the cost of heating rooms:</h2>
<p>Let us discuss how to compute the cost of heating a new room given some rooms have already been booked.</p>
<h3 id="graph-qualitative-discussion">Qualitative discussion:</h3>
<p>As a first order approximation, we can consider that the cost of heating a given room is the cost of heating that room if it was the only room used that day, minus the energy savings coming from other rooms that have already been booked.
We assume those energy savings come from three sources:
*  Heating a room that shares a wall in the same time slot with a room that is already in use,
* The room is already warm because it has been used in the previous time slot,
* If this room is booked, it will already be warm when used in the next time slot.</p>
<p>Intuitively we can think of this model as each room as having an intrinsic cost and then receiving messages from its nearest neighbors in graph <span class="arithmatex">\(G\)</span> telling it to reduce its cost if they are already booked. The optimal rooms to book will be those that receive the most (or the most important) messages, thus, having the lowest cost.</p>
<p>The parameter <span class="arithmatex">\(\lambda\)</span> in the definition of <span class="arithmatex">\(G\)</span> controls the relative importance of the messages:
- if <span class="arithmatex">\(\lambda &gt; 1\)</span>, booking the same room over time is favored over booking adjacent rooms
- if <span class="arithmatex">\(\lambda &lt; 1\)</span>, booking adjacent rooms is favored over booking the same room at subsequent time slots
- and if <span class="arithmatex">\(\lambda = 1\)</span>, the space and time components are treated on equal footing.</p>
<p>The following section discusses a way of formalizing and implementing this model.</p>
<h3 id="graph-mathematical-formulation-of-the-model">Mathematical formulation of the model</h3>
<p>Let <span class="arithmatex">\(s\)</span> be the <em>schedule</em> vector, of size <span class="arithmatex">\(N_r N_t\)</span>, such that</p>
<div class="arithmatex">\[
s_i = \begin{cases}
1 &amp; \text{if room } (i \mod N_r) \text{ room is booked} \\
 &amp; \text{at time } (i \div N_t), \\
0 &amp; \text{otherwise};
\end{cases}
\]</div>
<p>where <span class="arithmatex">\(\div\)</span> represents the integer division and $ \cdot\mod{\cdot}$ represents its reminder.</p>
<p>Equipped with this notation, we can write the first-order approximation of the cost as follows:</p>
<div class="arithmatex">\[
c = c_a - \eta As,
\]</div>
<p>where <span class="arithmatex">\(c\)</span> is the cost vector representing the cost of heating the room, <span class="arithmatex">\(c_a\)</span> is a vector representing the cost of heating the room if this room at this time slot was the only room booked that day, and <span class="arithmatex">\(\eta\)</span> is a scalar coefficient representing the relative importance of the messages <span class="arithmatex">\(As\)</span> compared to the alone costs <span class="arithmatex">\(c_a\)</span>.</p>
<h2 id="graph-example">Example:</h2>
<p>Let the school have 4 rooms, whose connectivity is given by the following spatial adjacency matrix:</p>
<div class="arithmatex">\[
A_s = \left(\begin{matrix}
0 &amp; 1 &amp; 1 &amp; 0 \\
1 &amp; 0 &amp; 0 &amp; 1 \\
1 &amp; 0 &amp; 0 &amp; 1 \\
0 &amp; 1 &amp; 1 &amp; 0
\end{matrix} \right).
\]</div>
<p>The identity matrix for 4 rooms is given by:</p>
<div class="arithmatex">\[
\mathbb{I} = \left(\begin{matrix}
1 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 1 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 1
\end{matrix} \right)
\]</div>
<p>and the null matrix by:</p>
<div class="arithmatex">\[
\mathbb{O} = \left(\begin{matrix}
0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0
\end{matrix} \right).
\]</div>
<p>Lets assume we have three time slots for the day in question, <span class="arithmatex">\(t=-1,0,1\)</span>. The adjacency matrix <span class="arithmatex">\(A\)</span> for the booking graph <span class="arithmatex">\(G\)</span> looks like:</p>
<div class="arithmatex">\[
A = \left(\begin{matrix}
A_s &amp; \lambda\mathbb{I} &amp; \mathbb{O} \\
\lambda\mathbb{I} &amp; A_s &amp; \lambda\mathbb{I} \\
\mathbb{O} &amp; \lambda\mathbb{I} &amp; A_s  \\
\end{matrix} \right).
\]</div>
<p>Lets say that the 0-th room was booked at time 0. Then, the schedule vector s looks like:</p>
<div class="arithmatex">\[
s = \left(\begin{matrix}
0 &amp; 0 &amp; 0 &amp; 0 \\
1 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 \\
\end{matrix} \right),
\]</div>
<p>where, <span class="arithmatex">\(s\)</span> has been displayed in a rooms <span class="arithmatex">\(\times\)</span> time_slots format for convenience, but please keep in mind that it is a 1-D vector.</p>
<p>The messages <span class="arithmatex">\(As\)</span> look like:</p>
<div class="arithmatex">\[
As = \left(\begin{matrix}
\lambda &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 1 &amp; 1 &amp; 0 \\
\lambda &amp; 0 &amp; 0 &amp; 0 \\
\end{matrix} \right),
\]</div>
<p>and, if we assume that all rooms where equally costly to heat alone, that is, <span class="arithmatex">\(c_a = k (1,1,\dots,1)\)</span>, then the cost of new possible bookings is:</p>
<div class="arithmatex">\[
c = \left(\begin{matrix}
k-\eta\lambda &amp; k &amp; k &amp; k \\
k &amp; k-\eta &amp; k-\eta &amp; k \\
k-\eta\lambda &amp; k &amp; k &amp; k \\
\end{matrix} \right),
\]</div>
<p>where <span class="arithmatex">\(k\)</span>, <span class="arithmatex">\(\eta\)</span> and <span class="arithmatex">\(\lambda\)</span> are positive numbers. Note that the room that is already booked doesn't have an outstandingly high cost to be re-booked, this is to be corrected in subsequent versions of the model.</p>
<p>If <span class="arithmatex">\(\lambda &gt; 1\)</span>, the model suggest that the optimal room to book is the 0-th room at time slots <span class="arithmatex">\(-1\)</span> or <span class="arithmatex">\(1\)</span>, while if its smaller than 1, then its rooms 1 and 2 at time 0 that are optimal for booking.</p></section><section class="print-page" id="capacity"><h1 id="capacity-model-for-capacity">Model for capacity</h1>
<p><em>Sprint 4 - AI version 2</em></p>
<p>Lets consider the problem with the capacity of the room.</p>
<ul>
<li>
<p>On the one hand side, it does not make sense to suggest the user a room that is too small for the planned activity: if the participants will not fit in the room, it does not matter if the energy required to heat it and light it is very low.</p>
</li>
<li>
<p>On the other hand side, we want to avoid recommending rooms that are far too big (see below for how we approach defining way too big) for the activity planned: First, because it might result on heating a very big room to have two people in it, but most importantly, because the room could be better booked later by a larger group.</p>
</li>
</ul>
<h3 id="capacity-mathematical-model">Mathematical model</h3>
<p>We approach the problem as finding a cost for mismatched capacity that can be added to the other energy costs, that is, the electricity and the heating cost.</p>
<p>We define the cost function <span class="arithmatex">\(C_c\)</span> for a required capacity (i.e. the number of participants in the activity) <span class="arithmatex">\(x\)</span> as for the <span class="arithmatex">\(i\)</span>-th room as:</p>
<div class="arithmatex">\[
C_c(x) = \begin{cases}
\infty &amp; \text{if } x &lt; c_i, \\
\alpha \frac{x-c_i}{c_i} &amp; x \leq c_i.
\end{cases}
\]</div>
<p>where <span class="arithmatex">\(c_i\)</span> is the capacity (i.e. the amount of people that fit) in room <span class="arithmatex">\(i\)</span> and <span class="arithmatex">\(\alpha\)</span> is a coefficient that can be adjusted for business purposes for each school.</p>
<p>Intuitively, this means that its not possible to book the room if <span class="arithmatex">\(x &lt; c_i\)</span>, since the participants will not fit, it is ''for free'' to book it if <span class="arithmatex">\(x=c_i\)</span>, since the participants match the capacity, and if there is free space, there is an additional cost of <span class="arithmatex">\(\alpha/c_i\)</span> for each free spot in the room.</p>
<p>The factor <span class="arithmatex">\(1/c_i\)</span> in the expression for the cost models the relative importance of having an extra free sit: while having 5 free spots in a room with capacity for 10 people is having half of the sits empty and is not desirable, having 5 free spots in a room with capacity for 100 people is not a big problem. The first will be punished with an extra <span class="arithmatex">\(0.5\alpha\)</span> cost while the second example will be punished with the much smaller <span class="arithmatex">\(0.05\alpha\)</span> cost.</p></section><h1 class='nav-section-title-end'>Ended: Principles behind the code</h1>
                        <h1 class='nav-section-title' id='section-reference'>
                            Reference <a class='headerlink' href='#section-reference' title='Permanent link'>â†µ</a>
                        </h1>
                        <section class="print-page" id="ref-recommender"><h1 id="ref-recommender-recommender">Recommender</h1>


<div class="doc doc-object doc-module">



<a id="thermo.recommender"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">




<h2 id="ref-recommender-thermo.recommender.Recommendation" class="doc doc-heading">
          <span class="doc doc-object-name doc-class-name">Recommendation</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ref-recommender-__codelineno-0-1"></a><span class="n">Recommendation</span><span class="p">(</span><span class="n">ranking</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">room_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span>
</span></code></pre></div>

  <div class="doc doc-contents ">

  
      <p>Class to contain the postprocessing of recommendations.
Args:
    ranking: the output of a Ranker.run call.
    room_names: names of the rooms for display</p>

              <details class="quote">
                <summary>Source code in <code>thermo/recommender.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#ref-recommender-__codelineno-0-28">28</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-29">29</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ranking</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">room_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">ranking</span> <span class="o">=</span> <span class="n">to_frame</span><span class="p">(</span><span class="n">ranking</span><span class="p">,</span> <span class="n">room_names</span><span class="o">=</span><span class="n">room_names</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
              </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="ref-recommender-thermo.recommender.Recommendation.show" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">show</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ref-recommender-__codelineno-0-1"></a><span class="n">show</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Styler</span>
</span></code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Returns a styled DataFrame with a color gradient.
Formats the DataFrame to 1 decimal place and
replaces NaN values with blank value.</p>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span data-autorefs-optional-hover="pandas.io.formats.style.Styler">Styler</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>pandas.io.formats.style.Styler: styled DataFrame</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>thermo/recommender.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#ref-recommender-__codelineno-0-31">31</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-32">32</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-33">33</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-34">34</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-35">35</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-36">36</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-37">37</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-38">38</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-39">39</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-40">40</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Styler</span><span class="p">:</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    Returns a styled DataFrame with a color gradient.</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">    Formats the DataFrame to 1 decimal place and</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">    replaces NaN values with blank value.</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">    Returns:</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">        pandas.io.formats.style.Styler: styled DataFrame</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="k">return</span> <span class="n">show_recommendations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ranking</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="ref-recommender-thermo.recommender.Recommendation.top_recommendations" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">top_recommendations</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ref-recommender-__codelineno-0-1"></a><span class="n">top_recommendations</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span>
</span></code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Returns a sorted list of recommendations, with columns
"Time Slot", "Room", "Score"</p>

          <details class="quote">
            <summary>Source code in <code>thermo/recommender.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#ref-recommender-__codelineno-0-49">49</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-50">50</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-51">51</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-52">52</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-53">53</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-54">54</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="k">def</span> <span class="nf">top_recommendations</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">    Returns a sorted list of recommendations, with columns</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">    &quot;Time Slot&quot;, &quot;Room&quot;, &quot;Score&quot;</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a>    <span class="k">return</span> <span class="n">list_recommendations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ranking</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="ref-recommender-thermo.recommender.Recommender" class="doc doc-heading">
          <span class="doc doc-object-name doc-class-name">Recommender</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ref-recommender-__codelineno-0-1"></a><span class="n">Recommender</span><span class="p">(</span><span class="n">building</span><span class="p">:</span> <span class="n">Building</span><span class="p">,</span> <span class="n">ranker</span><span class="p">:</span> <span class="n">Ranker</span><span class="p">)</span>
</span></code></pre></div>

  <div class="doc doc-contents ">

  
      <p>Interface for GUI or API to interact with the rest of thermo.</p>
  
      <p>Init method, intended for testing purposes and not for human
use. We recommend instantiating recommenders from config files
by calling Recommender.from_config(school_name).</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>building</code></td>
          <td>
                <code><span data-autorefs-optional-hover="thermo.utils.building.Building">Building</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Building object containing the adjacency matrix,
room descriptions and costs etc.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>ranker</code></td>
          <td>
                <code><span data-autorefs-optional-hover="thermo.ranker.Ranker">Ranker</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Object to orchestrate the different costs and how they are
combined. Examples of costs are <code>thermo.costs.HeatingCost</code> or
<code>thermo.costs.CapacityCost</code>.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

              <details class="quote">
                <summary>Source code in <code>thermo/recommender.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#ref-recommender-__codelineno-0-62">62</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-63">63</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-64">64</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-65">65</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-66">66</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-67">67</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-68">68</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-69">69</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-70">70</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-71">71</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-72">72</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-73">73</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-74">74</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-75">75</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-76">76</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-77">77</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-78">78</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-79">79</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-80">80</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-81">81</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-82">82</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="n">building</span><span class="p">:</span> <span class="n">Building</span><span class="p">,</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="n">ranker</span><span class="p">:</span> <span class="n">Ranker</span><span class="p">,</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="p">):</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">    Init method, intended for testing purposes and not for human</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">    use. We recommend instantiating recommenders from config files</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">    by calling Recommender.from_config(school_name).</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">    Args:</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        building: Building object containing the adjacency matrix,</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">            room descriptions and costs etc.</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">        ranker: Object to orchestrate the different costs and how they are</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">            combined. Examples of costs are `thermo.costs.HeatingCost` or</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">            `thermo.costs.CapacityCost`.</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">building</span> <span class="o">=</span> <span class="n">building</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_room_names</span> <span class="o">=</span> <span class="n">building</span><span class="o">.</span><span class="n">get_room_attr</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">ranker</span> <span class="o">=</span> <span class="n">ranker</span>
</span></code></pre></div></td></tr></table></div>
              </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="ref-recommender-thermo.recommender.Recommender.from_config" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">from_config</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ref-recommender-__codelineno-0-1"></a><span class="n">from_config</span><span class="p">(</span><span class="n">building_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Recommender</span>
</span></code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Creates a Recommender from the config files of a building.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>building_name</code></td>
          <td>
                <code><span data-autorefs-optional="str">str</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Name of the building, as in the path to its config
files.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span data-autorefs-optional-hover="thermo.recommender.Recommender">Recommender</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A recommender based on the configuration for that building found in
<code>buildings/building_name</code>.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>thermo/recommender.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#ref-recommender-__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-100">100</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-101">101</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-102">102</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-103">103</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-104">104</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-105">105</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-106">106</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-107">107</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-108">108</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-109">109</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-110">110</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-111">111</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-112">112</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-113">113</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-114">114</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="nd">@classmethod</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="k">def</span> <span class="nf">from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">building_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Recommender&quot;</span><span class="p">:</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">    Creates a Recommender from the config files of a building.</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">    Args:</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">        building_name: Name of the building, as in the path to its config</span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">            files.</span>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">    Returns:</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">        A recommender based on the configuration for that building found in</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">            `buildings/building_name`.</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="n">building_path</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">get_building_path</span><span class="p">(</span><span class="n">building_name</span><span class="p">)</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="n">building</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">load_building</span><span class="p">(</span><span class="n">building_path</span><span class="p">)</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="n">costs</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="n">make_cost</span><span class="p">(</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a>            <span class="n">name</span><span class="o">=</span><span class="n">key</span><span class="p">,</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a>            <span class="n">adjacency</span><span class="o">=</span><span class="n">building</span><span class="o">.</span><span class="n">adjacency</span><span class="p">,</span>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a>            <span class="n">room_descriptions</span><span class="o">=</span><span class="n">building</span><span class="o">.</span><span class="n">room_descriptions</span><span class="p">,</span>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a>            <span class="o">**</span><span class="n">values</span><span class="p">,</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="p">)</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">building</span><span class="o">.</span><span class="n">costs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a>    <span class="p">]</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a>    <span class="n">ranker</span> <span class="o">=</span> <span class="n">make_ranker</span><span class="p">(</span><span class="n">ranker_name</span><span class="o">=</span><span class="n">building</span><span class="o">.</span><span class="n">ranker</span><span class="p">,</span> <span class="n">costs</span><span class="o">=</span><span class="n">costs</span><span class="p">)</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a>    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="n">building</span><span class="o">=</span><span class="n">building</span><span class="p">,</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="n">ranker</span><span class="o">=</span><span class="n">ranker</span><span class="p">,</span>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="ref-recommender-thermo.recommender.Recommender.run" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">run</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ref-recommender-__codelineno-0-1"></a><span class="n">run</span><span class="p">(</span><span class="n">day</span><span class="p">:</span> <span class="n">date</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Recommendation</span>
</span></code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Produces a recommendation of which rooms to book given a date.
The method calls internally the schools API to determine which
books have been already booked.</p>
<p>It then calls all the costs and combines them according to the
ranker, to return an instance of Recommendation, with all
the costs for the rooms.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>day</code></td>
          <td>
                <code><span data-autorefs-optional-hover="datetime.date">date</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>date for which the user desires make a booking.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>kwargs</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>other possible run-time parameters for the costs.</p>
            </div>
          </td>
          <td>
                <code>{}</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span data-autorefs-optional-hover="thermo.recommender.Recommendation">Recommendation</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The costs of the recommended possible bookings.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>thermo/recommender.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#ref-recommender-__codelineno-0-116">116</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-117">117</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-118">118</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-119">119</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-120">120</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-121">121</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-122">122</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-123">123</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-124">124</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-125">125</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-126">126</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-127">127</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-128">128</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-129">129</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-130">130</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-131">131</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-132">132</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-133">133</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-134">134</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-135">135</a></span>
<span class="normal"><a href="#ref-recommender-__codelineno-0-136">136</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">day</span><span class="p">:</span> <span class="n">date</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Recommendation</span><span class="p">:</span>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">    Produces a recommendation of which rooms to book given a date.</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">    The method calls internally the schools API to determine which</span>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">    books have been already booked.</span>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">    It then calls all the costs and combines them according to the</span>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">    ranker, to return an instance of Recommendation, with all</span>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">    the costs for the rooms.</span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">    Args:</span>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">        day: date for which the user desires make a booking.</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">        kwargs: other possible run-time parameters for the costs.</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">    Returns:</span>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">        The costs of the recommended possible bookings.</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a>    <span class="n">state</span> <span class="o">=</span> <span class="n">get_state</span><span class="p">(</span><span class="n">day</span><span class="p">)</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a>    <span class="n">n_time_slots</span> <span class="o">=</span> <span class="n">get_time_slots</span><span class="p">(</span><span class="n">day</span><span class="p">)</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="n">recommendation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranker</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">n_time_slots</span><span class="o">=</span><span class="n">n_time_slots</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="k">return</span> <span class="n">Recommendation</span><span class="p">(</span><span class="n">recommendation</span><span class="p">,</span> <span class="n">room_names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_room_names</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div></section><section class="print-page" id="ref-ranker"><h1 id="ref-ranker-rankername">RankerName</h1>


<div class="doc doc-object doc-attribute">



<a id="thermo.ranker.RankerName"></a>
  <div class="doc doc-contents first">
  
      <p>Names of all Ranker classes in <code>thermo</code>: <code>FullRanker</code></p>
  </div>

</div><h1 id="make_ranker">make_ranker</h1>



<div class="doc doc-object doc-function">



<a id="thermo.ranker.make_ranker"></a>
  <div class="doc doc-contents first">
  
      <p>Creates a Ranker object given its name, and the costs that it ranks.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>ranker_name</code></td>
          <td>
                <code><span data-autorefs-optional-hover="thermo.ranker.RankerName">RankerName</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Name of the ranker</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>costs</code></td>
          <td>
                <code><span data-autorefs-optional="list">list</span>[<span data-autorefs-optional-hover="thermo.costs.base.CostModel">CostModel</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Cost instances to compute the cost of each room.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>kwargs</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>other possible arguments to the init method of the
ranker.</p>
            </div>
          </td>
          <td>
                <code>{}</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span data-autorefs-optional-hover="thermo.ranker.base.Ranker">Ranker</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>an instance of the <code>ranker_name</code> class.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>thermo/ranker/__init__.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#ref-ranker-__codelineno-0-11">11</a></span>
<span class="normal"><a href="#ref-ranker-__codelineno-0-12">12</a></span>
<span class="normal"><a href="#ref-ranker-__codelineno-0-13">13</a></span>
<span class="normal"><a href="#ref-ranker-__codelineno-0-14">14</a></span>
<span class="normal"><a href="#ref-ranker-__codelineno-0-15">15</a></span>
<span class="normal"><a href="#ref-ranker-__codelineno-0-16">16</a></span>
<span class="normal"><a href="#ref-ranker-__codelineno-0-17">17</a></span>
<span class="normal"><a href="#ref-ranker-__codelineno-0-18">18</a></span>
<span class="normal"><a href="#ref-ranker-__codelineno-0-19">19</a></span>
<span class="normal"><a href="#ref-ranker-__codelineno-0-20">20</a></span>
<span class="normal"><a href="#ref-ranker-__codelineno-0-21">21</a></span>
<span class="normal"><a href="#ref-ranker-__codelineno-0-22">22</a></span>
<span class="normal"><a href="#ref-ranker-__codelineno-0-23">23</a></span>
<span class="normal"><a href="#ref-ranker-__codelineno-0-24">24</a></span>
<span class="normal"><a href="#ref-ranker-__codelineno-0-25">25</a></span>
<span class="normal"><a href="#ref-ranker-__codelineno-0-26">26</a></span>
<span class="normal"><a href="#ref-ranker-__codelineno-0-27">27</a></span>
<span class="normal"><a href="#ref-ranker-__codelineno-0-28">28</a></span>
<span class="normal"><a href="#ref-ranker-__codelineno-0-29">29</a></span>
<span class="normal"><a href="#ref-ranker-__codelineno-0-30">30</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="k">def</span> <span class="nf">make_ranker</span><span class="p">(</span><span class="n">ranker_name</span><span class="p">:</span> <span class="n">RankerName</span><span class="p">,</span> <span class="n">costs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">CostModel</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Ranker</span><span class="p">:</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="sd">    Creates a Ranker object given its name, and the costs that it ranks.</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">    Args:</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="sd">        ranker_name: Name of the ranker</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="sd">        costs: Cost instances to compute the cost of each room.</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">        kwargs: other possible arguments to the init method of the</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">            ranker.</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">    Returns:</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">        an instance of the `ranker_name` class.</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a>    <span class="k">match</span> <span class="n">ranker_name</span><span class="p">:</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a>        <span class="k">case</span> <span class="s2">&quot;FullRanker&quot;</span><span class="p">:</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a>            <span class="n">ranker</span> <span class="o">=</span> <span class="n">FullRanker</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a>        <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ranker </span><span class="si">{</span><span class="n">ranker_name</span><span class="si">}</span><span class="s2"> not implemented&quot;</span><span class="p">)</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a>    <span class="k">return</span> <span class="n">ranker</span><span class="p">(</span><span class="n">costs</span><span class="o">=</span><span class="n">costs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>

<div class="doc doc-object doc-module">



<a id="thermo.ranker.full"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">




<h2 id="ref-ranker-thermo.ranker.full.FullRanker" class="doc doc-heading">
          <span class="doc doc-object-name doc-class-name">FullRanker</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ref-ranker-__codelineno-0-1"></a><span class="n">FullRanker</span><span class="p">(</span><span class="n">costs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">CostModel</span><span class="p">])</span>
</span></code></pre></div>

  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span data-autorefs-optional-hover="thermo.ranker.base.Ranker">Ranker</span></code></p>

  
      <p>Calculates the cost for the full schedule:
i.e. all rooms for all time slots.
The total cost is computed as the sum of individual costs.
Args:
    costs: list of instances of costs models to compute the costs from.</p>

              <details class="quote">
                <summary>Source code in <code>thermo/ranker/full.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#ref-ranker-__codelineno-0-17">17</a></span>
<span class="normal"><a href="#ref-ranker-__codelineno-0-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">costs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">CostModel</span><span class="p">]):</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">costs</span><span class="o">=</span><span class="n">costs</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
              </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="ref-ranker-thermo.ranker.full.FullRanker.run" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">run</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ref-ranker-__codelineno-0-1"></a><span class="n">run</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span>
</span></code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Adds up costs from individual cost sources, to return
the cost of booking a given room for a given time slot.
Args:
    state: state: a flat array containing 1 if the room is booked
        at that time a zero otherwise.
    kwargs: other possible arguments to the run method.</p>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span data-autorefs-optional-hover="numpy.typing.NDArray">NDArray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An array of the same shape as the state, containing the costs.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>thermo/ranker/full.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#ref-ranker-__codelineno-0-20">20</a></span>
<span class="normal"><a href="#ref-ranker-__codelineno-0-21">21</a></span>
<span class="normal"><a href="#ref-ranker-__codelineno-0-22">22</a></span>
<span class="normal"><a href="#ref-ranker-__codelineno-0-23">23</a></span>
<span class="normal"><a href="#ref-ranker-__codelineno-0-24">24</a></span>
<span class="normal"><a href="#ref-ranker-__codelineno-0-25">25</a></span>
<span class="normal"><a href="#ref-ranker-__codelineno-0-26">26</a></span>
<span class="normal"><a href="#ref-ranker-__codelineno-0-27">27</a></span>
<span class="normal"><a href="#ref-ranker-__codelineno-0-28">28</a></span>
<span class="normal"><a href="#ref-ranker-__codelineno-0-29">29</a></span>
<span class="normal"><a href="#ref-ranker-__codelineno-0-30">30</a></span>
<span class="normal"><a href="#ref-ranker-__codelineno-0-31">31</a></span>
<span class="normal"><a href="#ref-ranker-__codelineno-0-32">32</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">:</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">    Adds up costs from individual cost sources, to return</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">    the cost of booking a given room for a given time slot.</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">    Args:</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">        state: state: a flat array containing 1 if the room is booked</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">            at that time a zero otherwise.</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">        kwargs: other possible arguments to the run method.</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">    Returns:</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">        An array of the same shape as the state, containing the costs.</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">cost</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">cost</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">costs</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div></section><section class="print-page" id="ref-cost"><h1 id="ref-cost-costname">CostName</h1>


<div class="doc doc-object doc-attribute">



<a id="thermo.costs.CostName"></a>
  <div class="doc doc-contents first">
  
      <p>Names of all CostModel classes in <code>thermo</code>:
<code>HeatingCost</code>, <code>CapacityCost</code> <code>AmenityCost</code></p>
  </div>

</div><h1 id="make_cost">make_cost</h1>



<div class="doc doc-object doc-function">



<a id="thermo.costs.make_cost"></a>
  <div class="doc doc-contents first">
  
      <p>Creates a CostModel object given its name, and parameters.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>name</code></td>
          <td>
                <code><span data-autorefs-optional-hover="thermo.costs.CostName">CostName</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Name of the CostModel class</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>kwargs</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>other possible arguments to the init method of the
CostModel.</p>
            </div>
          </td>
          <td>
                <code>{}</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span data-autorefs-optional-hover="thermo.costs.base.CostModel">CostModel</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>an instance of the <code>name</code> class.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>thermo/costs/__init__.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#ref-cost-__codelineno-0-13">13</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-14">14</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-15">15</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-16">16</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-17">17</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-18">18</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-19">19</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-20">20</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-21">21</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-22">22</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-23">23</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-24">24</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-25">25</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-26">26</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-27">27</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-28">28</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-29">29</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-30">30</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-31">31</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-32">32</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-33">33</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="k">def</span> <span class="nf">make_cost</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="n">CostName</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CostModel</span><span class="p">:</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">    Creates a CostModel object given its name, and parameters.</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="sd">    Args:</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">        name: Name of the CostModel class</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">        kwargs: other possible arguments to the init method of the</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">            CostModel.</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">    Returns:</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">        an instance of the `name` class.</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a>    <span class="k">match</span> <span class="n">name</span><span class="p">:</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a>        <span class="k">case</span> <span class="s2">&quot;HeatingCost&quot;</span><span class="p">:</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a>            <span class="k">return</span> <span class="n">HeatingCost</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a>        <span class="k">case</span> <span class="s2">&quot;CapacityCost&quot;</span><span class="p">:</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a>            <span class="k">return</span> <span class="n">CapacityCost</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a>        <span class="k">case</span> <span class="s2">&quot;AmenityCost&quot;</span><span class="p">:</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a>            <span class="k">return</span> <span class="n">AmenityCost</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a>        <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CostModel </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> not implemented.&quot;</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>

<div class="doc doc-object doc-module">



<a id="thermo.costs.heating"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">




<h2 id="ref-cost-thermo.costs.heating.HeatingCost" class="doc doc-heading">
          <span class="doc doc-object-name doc-class-name">HeatingCost</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ref-cost-__codelineno-0-1"></a><span class="n">HeatingCost</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">adjacency</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">t_weight</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">message_importance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">heat_cost</span><span class="p">:</span> <span class="n">NDArray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">unavailable_cost</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">UNAVAILABLE_COST</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></code></pre></div>

  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span data-autorefs-optional-hover="thermo.costs.base.CostModel">CostModel</span></code></p>

  
      <p>Class to simulate the heating cost of a room.
Args:
    adjacency: Adjacency matrix for space (n_rooms x n_rooms)
        tb_added.
    unavailable_cost: number associated to the room already
        being booked
    t_weight: weight of time in the adjacency matrix
    message_importance: weight of the message in the cost
        function
    heat_cost: cost of heating each room</p>

              <details class="quote">
                <summary>Source code in <code>thermo/costs/heating.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#ref-cost-__codelineno-0-12">12</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-13">13</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-14">14</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-15">15</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-16">16</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-17">17</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-18">18</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-19">19</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-20">20</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-21">21</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-22">22</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-23">23</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-24">24</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-25">25</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-26">26</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-27">27</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-28">28</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-29">29</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-30">30</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-31">31</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-32">32</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-33">33</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-34">34</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-35">35</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-36">36</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-37">37</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-38">38</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-39">39</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a>    <span class="n">adjacency</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a>    <span class="n">t_weight</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a>    <span class="n">message_importance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a>    <span class="n">heat_cost</span><span class="p">:</span> <span class="n">NDArray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a>    <span class="n">unavailable_cost</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">UNAVAILABLE_COST</span><span class="p">,</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a>    <span class="o">**</span><span class="n">kwargs</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="p">):</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">    Class to simulate the heating cost of a room.</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">    Args:</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">        adjacency: Adjacency matrix for space (n_rooms x n_rooms)</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">            tb_added.</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">        unavailable_cost: number associated to the room already</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">            being booked</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">        t_weight: weight of time in the adjacency matrix</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">        message_importance: weight of the message in the cost</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">            function</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">        heat_cost: cost of heating each room</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">As</span> <span class="o">=</span> <span class="n">adjacency</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">n_rooms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">As</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">t_weight</span> <span class="o">=</span> <span class="n">t_weight</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">message_importance</span> <span class="o">=</span> <span class="n">message_importance</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">heat_cost</span> <span class="o">=</span> <span class="n">heat_cost</span> <span class="k">if</span> <span class="n">heat_cost</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_rooms</span><span class="p">)</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">unavailable_cost</span> <span class="o">=</span> <span class="n">unavailable_cost</span>
</span></code></pre></div></td></tr></table></div>
              </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="ref-cost-thermo.costs.heating.HeatingCost.run" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">run</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ref-cost-__codelineno-0-1"></a><span class="n">run</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">n_time_slots</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span>
</span></code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Compute the cost of each possible booking given the current state
of the booking.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>state</code></td>
          <td>
                <code><span data-autorefs-optional-hover="numpy.typing.NDArray">NDArray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>ones and zeros representing bookings
shape = (n_rooms*n_time_slots,),</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>n_time_slots</code></td>
          <td>
                <code><span data-autorefs-optional="int">int</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>number of time slots in the schedule
(per day)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>cost_vector</code></td>          <td>
                <code><span data-autorefs-optional-hover="numpy.typing.NDArray">NDArray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>where the lower the better.
shape = (n_rooms*n_time_slots,),
if room already booked, its np.nan</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>thermo/costs/heating.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#ref-cost-__codelineno-0-51">51</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-52">52</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-53">53</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-54">54</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-55">55</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-56">56</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-57">57</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-58">58</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-59">59</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-60">60</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-61">61</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-62">62</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-63">63</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-64">64</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-65">65</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-66">66</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-67">67</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-68">68</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-69">69</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-70">70</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-71">71</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">n_time_slots</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">:</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">    Compute the cost of each possible booking given the current state</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">    of the booking.</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">    Args:</span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">        state: ones and zeros representing bookings</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">            shape = (n_rooms*n_time_slots,),</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">        n_time_slots: number of time slots in the schedule</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">            (per day)</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">    Returns:</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">        cost_vector: where the lower the better.</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">            shape = (n_rooms*n_time_slots,),</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">            if room already booked, its np.nan</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_full_graph</span><span class="p">(</span><span class="n">n_time_slots</span><span class="o">=</span><span class="n">n_time_slots</span><span class="p">)</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_full_heat_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_full_cost</span><span class="p">(</span><span class="n">n_time_slots</span><span class="o">=</span><span class="n">n_time_slots</span><span class="p">)</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_full_heat_cost</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">message_importance</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unavailable_cost</span> <span class="o">*</span> <span class="n">state</span> <span class="o">+</span> <span class="n">out</span>
</span></code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<a id="thermo.costs.capacity"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">




<h2 id="ref-cost-thermo.costs.capacity.CapacityCost" class="doc doc-heading">
          <span class="doc doc-object-name doc-class-name">CapacityCost</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ref-cost-__codelineno-0-1"></a><span class="n">CapacityCost</span><span class="p">(</span><span class="n">room_descriptions</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Room</span><span class="p">],</span> <span class="n">capacity_utilization_coeff</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">unavailable_cost</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">UNAVAILABLE_COST</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></code></pre></div>

  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span data-autorefs-optional-hover="thermo.costs.base.CostModel">CostModel</span></code></p>

  
      <p>Class to simulate the capacity cost of a room:</p>
<p>Room capacity cost is intuitively based on a Lennard-Jones
potential function with a minimum at the required capacity.
Rooms with <code>capacity</code> &lt; <code>required capacity</code> have very high cost
(unavailable_cost), while the cost for rooms with <code>capacity</code></p>
<blockquote>
<p>= <code>required capacity</code> scales with the difference between the
room capacity and required capacity.</p>
</blockquote>
<p>Note: We assume that room capacities are fixed across time.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>room_descriptions</code></td>
          <td>
                <code><span data-autorefs-optional="list">list</span>[<span data-autorefs-optional-hover="thermo.utils.room.Room">Room</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>list of Room objects describing the
rooms in the building</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>unavailable_cost</code></td>
          <td>
                <code><span data-autorefs-optional="float">float</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>number associated to the room already
being booked</p>
            </div>
          </td>
          <td>
                <code><span data-autorefs-optional-hover="thermo.config.UNAVAILABLE_COST">UNAVAILABLE_COST</span></code>
          </td>
        </tr>
        <tr>
          <td><code>coefficent</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>coefficient for adjusting the cost function
to be more or less steep</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

              <details class="quote">
                <summary>Source code in <code>thermo/costs/capacity.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#ref-cost-__codelineno-0-12">12</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-13">13</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-14">14</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-15">15</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-16">16</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-17">17</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-18">18</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-19">19</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-20">20</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-21">21</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-22">22</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-23">23</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-24">24</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-25">25</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-26">26</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-27">27</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-28">28</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-29">29</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-30">30</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-31">31</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-32">32</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-33">33</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-34">34</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-35">35</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-36">36</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-37">37</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-38">38</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-39">39</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-40">40</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-41">41</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-42">42</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a>    <span class="n">room_descriptions</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Room</span><span class="p">],</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a>    <span class="n">capacity_utilization_coeff</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a>    <span class="n">unavailable_cost</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">UNAVAILABLE_COST</span><span class="p">,</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a>    <span class="o">**</span><span class="n">kwargs</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="p">):</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">    Class to simulate the capacity cost of a room:</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">    Room capacity cost is intuitively based on a Lennard-Jones</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">    potential function with a minimum at the required capacity.</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">    Rooms with `capacity` &lt; `required capacity` have very high cost</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">    (unavailable_cost), while the cost for rooms with `capacity`</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">    &gt;= `required capacity` scales with the difference between the</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">    room capacity and required capacity.</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">    Note: We assume that room capacities are fixed across time.</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    Args:</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">        room_descriptions: list of Room objects describing the</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">            rooms in the building</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">        unavailable_cost: number associated to the room already</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">            being booked</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">        coefficent: coefficient for adjusting the cost function</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">            to be more or less steep</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">room_descriptions</span> <span class="o">=</span> <span class="n">room_descriptions</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">coeff</span> <span class="o">=</span> <span class="n">capacity_utilization_coeff</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">unavailable_cost</span> <span class="o">=</span> <span class="n">unavailable_cost</span>
</span></code></pre></div></td></tr></table></div>
              </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">




<h3 id="ref-cost-thermo.costs.capacity.CapacityCost.n_rooms" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">n_rooms</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ref-cost-__codelineno-0-1"></a><span class="n">n_rooms</span><span class="p">:</span> <span class="nb">int</span>
</span></code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Number of rooms</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h3 id="ref-cost-thermo.costs.capacity.CapacityCost.room_capacities" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">room_capacities</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-cached"><code>cached</code></small>
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ref-cost-__codelineno-0-1"></a><span class="n">room_capacities</span><span class="p">:</span> <span class="n">NDArray</span>
</span></code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Capacities of all rooms</p>
  </div>

</div>




<div class="doc doc-object doc-function">




<h3 id="ref-cost-thermo.costs.capacity.CapacityCost.run" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">run</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ref-cost-__codelineno-0-1"></a><span class="n">run</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">n_time_slots</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">required_capacity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span>
</span></code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Calculate the capacity cost for each room-time combination,
setting the cost to a very high number if the room is too small.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>state</code></td>
          <td>
                <code><span data-autorefs-optional-hover="numpy.typing.NDArray">NDArray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>ones and zeros representing bookings
shape = (n_rooms, n_time_slots)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>n_time_slots</code></td>
          <td>
                <code><span data-autorefs-optional="int">int</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>number of time slots to consider</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>required_capacity</code></td>
          <td>
                <code><span data-autorefs-optional="int">int</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>required room capacity to
hold the party of the booker.</p>
            </div>
          </td>
          <td>
                <code>10</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>cost</code></td>          <td>
                <code><span data-autorefs-optional-hover="numpy.typing.NDArray">NDArray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>where the lower the better and very high if room
is too small. Shape = (n_rooms*n_time_slots,)</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>thermo/costs/capacity.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#ref-cost-__codelineno-0-58">58</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-59">59</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-60">60</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-61">61</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-62">62</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-63">63</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-64">64</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-65">65</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-66">66</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-67">67</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-68">68</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-69">69</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-70">70</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-71">71</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-72">72</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-73">73</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-74">74</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-75">75</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-76">76</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-77">77</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-78">78</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-79">79</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-80">80</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-81">81</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-82">82</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="k">def</span> <span class="nf">run</span><span class="p">(</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">n_time_slots</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">required_capacity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">:</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">    Calculate the capacity cost for each room-time combination,</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    setting the cost to a very high number if the room is too small.</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">    Args:</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">        state: ones and zeros representing bookings</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">            shape = (n_rooms, n_time_slots)</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">        n_time_slots: number of time slots to consider</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">        required_capacity: required room capacity to</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">            hold the party of the booker.</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">    Returns:</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        cost: where the lower the better and very high if room</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">            is too small. Shape = (n_rooms*n_time_slots,)</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a>    <span class="n">_filter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">room_capacities</span> <span class="o">&lt;</span> <span class="n">required_capacity</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="n">capacity_costs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_costs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">room_capacities</span><span class="p">,</span> <span class="n">required_capacity</span><span class="p">)</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="n">room_costs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">_filter</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unavailable_cost</span><span class="p">,</span> <span class="n">capacity_costs</span><span class="p">)</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a>    <span class="c1"># return explodes capacities to match state shape</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">room_costs</span><span class="p">,</span> <span class="n">n_time_slots</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<a id="thermo.costs.amenity"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">




<h2 id="ref-cost-thermo.costs.amenity.AmenityCost" class="doc doc-heading">
          <span class="doc doc-object-name doc-class-name">AmenityCost</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ref-cost-__codelineno-0-1"></a><span class="n">AmenityCost</span><span class="p">(</span><span class="n">room_descriptions</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Room</span><span class="p">],</span> <span class="n">unavailable_cost</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">UNAVAILABLE_COST</span><span class="p">,</span> <span class="n">amenity_utilization_coeff</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.15</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></code></pre></div>

  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span data-autorefs-optional-hover="thermo.costs.base.CostModel">CostModel</span></code></p>

  
      <p>Class to calculate the amenity cost of all rooms:</p>
<p>Room amenities are functionalities inherent to each room,
such as a screen projector, a whiteboard, musical instruments
etc. Rooms without the amenities listed in <code>required amenities</code>
have very high cost (denoted unavailable_cost). Conversely, the
amenity cost of rooms with all or some of the amenities listed
in <code>required amenities</code> scales with the difference between the
number of amenities in the room and the number of required
amenities.</p>
<p>Note: We assume that room amenities are fixed across time.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>room_descriptions</code></td>
          <td>
                <code><span data-autorefs-optional="list">list</span>[<span data-autorefs-optional-hover="thermo.utils.room.Room">Room</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>list of Room objects describing the
rooms in the building</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>unavailable_cost</code></td>
          <td>
                <code><span data-autorefs-optional="float">float</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>number assigned to a room w/o the
needed amenities.</p>
            </div>
          </td>
          <td>
                <code><span data-autorefs-optional-hover="thermo.config.UNAVAILABLE_COST">UNAVAILABLE_COST</span></code>
          </td>
        </tr>
        <tr>
          <td><code>coefficent</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>coefficient for adjusting the cost function
to be more or less steep</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

              <details class="quote">
                <summary>Source code in <code>thermo/costs/amenity.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#ref-cost-__codelineno-0-12">12</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-13">13</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-14">14</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-15">15</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-16">16</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-17">17</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-18">18</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-19">19</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-20">20</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-21">21</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-22">22</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-23">23</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-24">24</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-25">25</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-26">26</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-27">27</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-28">28</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-29">29</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-30">30</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-31">31</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-32">32</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-33">33</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-34">34</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-35">35</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-36">36</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-37">37</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-38">38</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-39">39</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-40">40</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-41">41</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-42">42</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-43">43</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-44">44</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-45">45</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a>    <span class="n">room_descriptions</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Room</span><span class="p">],</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a>    <span class="n">unavailable_cost</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">UNAVAILABLE_COST</span><span class="p">,</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a>    <span class="n">amenity_utilization_coeff</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.15</span><span class="p">,</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a>    <span class="o">**</span><span class="n">kwargs</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="p">):</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">    Class to calculate the amenity cost of all rooms:</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">    Room amenities are functionalities inherent to each room,</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">    such as a screen projector, a whiteboard, musical instruments</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">    etc. Rooms without the amenities listed in `required amenities`</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">    have very high cost (denoted unavailable_cost). Conversely, the</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">    amenity cost of rooms with all or some of the amenities listed</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">    in `required amenities` scales with the difference between the</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">    number of amenities in the room and the number of required</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">    amenities.</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    Note: We assume that room amenities are fixed across time.</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    Args:</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">        room_descriptions: list of Room objects describing the</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">            rooms in the building</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">        unavailable_cost: number assigned to a room w/o the</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">            needed amenities.</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">        coefficent: coefficient for adjusting the cost function</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">            to be more or less steep</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">room_descriptions</span> <span class="o">=</span> <span class="n">room_descriptions</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">unavailable_cost</span> <span class="o">=</span> <span class="n">unavailable_cost</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">coeff</span> <span class="o">=</span> <span class="n">amenity_utilization_coeff</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">len_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="nb">len</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
              </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">




<h3 id="ref-cost-thermo.costs.amenity.AmenityCost.room_amenities" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">room_amenities</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-cached"><code>cached</code></small>
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ref-cost-__codelineno-0-1"></a><span class="n">room_amenities</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>
</span></code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Amenities of all rooms</p>
  </div>

</div>




<div class="doc doc-object doc-function">




<h3 id="ref-cost-thermo.costs.amenity.AmenityCost.run" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">run</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ref-cost-__codelineno-0-1"></a><span class="n">run</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">n_time_slots</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">required_amenities</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span>
</span></code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Calculate the amenity cost for each room-time combination,
setting the cost to a very high number if the room does not
have the required amenities, i.e. is not useful.
Rooms are 'useful' when 'required_amenities' is a subset of
the room amenities. For useful rooms, the cost is given by
a parameterized discrepancy between of the number of amenities
in the room and the number of required amenities.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>state</code></td>
          <td>
                <code><span data-autorefs-optional-hover="numpy.typing.NDArray">NDArray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>ones and zeros representing bookings
shape = (n_rooms, n_time_slots)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>n_time_slots</code></td>
          <td>
                <code><span data-autorefs-optional="int">int</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>number of time slots to consider</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>required_amenities</code></td>
          <td>
                <code><span data-autorefs-optional="set">set</span>[<span data-autorefs-optional="str">str</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>required amenities for the
booking, e.g. {"projector", "whiteboard"}</p>
            </div>
          </td>
          <td>
                <code><span data-autorefs-optional="set">set</span>()</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>cost</code></td>          <td>
                <code><span data-autorefs-optional-hover="numpy.typing.NDArray">NDArray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>where the lower the better and very high if room
does not have required amenities
shape = (n_rooms*n_time_slots,)</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>thermo/costs/amenity.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#ref-cost-__codelineno-0-58">58</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-59">59</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-60">60</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-61">61</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-62">62</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-63">63</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-64">64</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-65">65</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-66">66</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-67">67</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-68">68</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-69">69</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-70">70</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-71">71</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-72">72</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-73">73</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-74">74</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-75">75</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-76">76</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-77">77</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-78">78</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-79">79</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-80">80</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-81">81</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-82">82</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-83">83</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-84">84</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-85">85</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-86">86</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-87">87</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-88">88</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-89">89</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-90">90</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-91">91</a></span>
<span class="normal"><a href="#ref-cost-__codelineno-0-92">92</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="k">def</span> <span class="nf">run</span><span class="p">(</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="n">state</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a>    <span class="n">n_time_slots</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="n">required_amenities</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(),</span>  <span class="c1"># noqa: B006</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="o">**</span><span class="n">kwargs</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">:</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">    Calculate the amenity cost for each room-time combination,</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">    setting the cost to a very high number if the room does not</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">    have the required amenities, i.e. is not useful.</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">    Rooms are &#39;useful&#39; when &#39;required_amenities&#39; is a subset of</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">    the room amenities. For useful rooms, the cost is given by</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">    a parameterized discrepancy between of the number of amenities</span>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">    in the room and the number of required amenities.</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">    Args:</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">        state: ones and zeros representing bookings</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">            shape = (n_rooms, n_time_slots)</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">        n_time_slots: number of time slots to consider</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">        required_amenities: required amenities for the</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">            booking, e.g. {&quot;projector&quot;, &quot;whiteboard&quot;}</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">    Returns:</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        cost: where the lower the better and very high if room</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">            does not have required amenities</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">            shape = (n_rooms*n_time_slots,)</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="n">useful_rooms</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="nb">map</span><span class="p">(</span><span class="n">required_amenities</span><span class="o">.</span><span class="n">issubset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">room_amenities</span><span class="p">)]</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="n">utilization</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_costs</span><span class="p">(</span><span class="n">required_amenities</span><span class="p">)</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a>    <span class="n">costs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">useful_rooms</span><span class="p">,</span> <span class="n">utilization</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unavailable_cost</span><span class="p">)</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a>    <span class="c1"># return exploded values to match state&#39;s shape</span>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">costs</span><span class="p">,</span> <span class="n">n_time_slots</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div></section>
                        <h2 class='nav-section-title' id='section-machine-learning-workflow'>
                            Machine Learning workflow <a class='headerlink' href='#section-machine-learning-workflow' title='Permanent link'>â†µ</a>
                        </h2>
                        <section class="print-page" id="ref-ml-get_data"><h1 id="ref-ml-get_data-get_datapy">get_data.py</h1>


<div class="doc doc-object doc-module">



<a id="thermo.stages.get_data"></a>
  <div class="doc doc-contents first">
  
      <p>This script takes data from different data sources,
stored as <code>csv</code> files under <code>assets/</code>, selects the relevant
subset of data.</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">




<h2 id="ref-ml-get_data-thermo.stages.get_data.RawDataFile" class="doc doc-heading">
          <span class="doc doc-object-name doc-class-name">RawDataFile</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">

  
      <p>Represents a raw data file with the instructions for parsing it</p>


  

  <div class="doc doc-children">











  </div>

  </div>

</div>



<div class="doc doc-object doc-function">




<h2 id="ref-ml-get_data-thermo.stages.get_data.from_csv" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">from_csv</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ref-ml-get_data-__codelineno-0-1"></a><span class="n">from_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">municipality</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
</span></code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Reads data from a CSV file and selects the data for a specific municipality
and year.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>file_path</code></td>
          <td>
                <code><span data-autorefs-optional-hover="pathlib.Path">Path</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The path to the CSV file.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>municipality</code></td>
          <td>
                <code><span data-autorefs-optional="str">str</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the municipality to filter the data for.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>year</code></td>
          <td>
                <code><span data-autorefs-optional="int">int</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The target year to keep in the data.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span data-autorefs-optional-hover="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The filtered dataset.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>thermo/stages/get_data.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#ref-ml-get_data-__codelineno-0-18">18</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-19">19</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-20">20</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-21">21</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-22">22</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-23">23</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-24">24</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-25">25</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-26">26</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-27">27</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-28">28</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-29">29</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-30">30</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-31">31</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-32">32</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-33">33</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-34">34</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-35">35</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-36">36</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-37">37</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-38">38</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-39">39</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-40">40</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-41">41</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-42">42</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-43">43</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-44">44</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-45">45</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-46">46</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-47">47</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-48">48</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-49">49</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-50">50</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-51">51</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-52">52</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-53">53</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-54">54</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="k">def</span> <span class="nf">from_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">municipality</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">    Reads data from a CSV file and selects the data for a specific municipality</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">    and year.</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">    Args:</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">        file_path: The path to the CSV file.</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">        municipality: The name of the municipality to filter the data for.</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">        year: The target year to keep in the data.</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">    Returns:</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">        The filtered dataset.</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loading data from file </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a>    <span class="c1"># Read DataFrame and keep only info for correct municipality</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a>    <span class="n">dataf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;pyarrow&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a>        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;MUNICIPALITY&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="n">municipality</span><span class="p">)</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a>    <span class="p">]</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="n">DATECOL</span> <span class="o">=</span> <span class="s2">&quot;DATE&quot;</span> <span class="k">if</span> <span class="s2">&quot;DATE&quot;</span> <span class="ow">in</span> <span class="n">dataf</span><span class="o">.</span><span class="n">columns</span> <span class="k">else</span> <span class="s2">&quot;DATO&quot;</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="n">LOCATIONCOLS</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a>        <span class="n">column</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a>        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">dataf</span><span class="o">.</span><span class="n">columns</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a>        <span class="k">if</span> <span class="n">column</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;MUNICIPALITY&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">column</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;SCHOOL&quot;</span><span class="p">)</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="p">]</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="c1"># Create a timestamp from date and time, keep only the target year</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a>    <span class="n">dataf</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a>        <span class="n">dataf</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a>            <span class="n">TIMESTAMP</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a>                <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">)(</span><span class="n">x</span><span class="p">[</span><span class="n">DATECOL</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;TIME&quot;</span><span class="p">])</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a>            <span class="p">)</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a>        <span class="p">)</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a>        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">DATECOL</span><span class="p">,</span> <span class="s2">&quot;TIME&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">LOCATIONCOLS</span><span class="p">)</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a>        <span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;TIMESTAMP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="n">year</span><span class="p">)]</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a>    <span class="p">)</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a>    <span class="k">return</span> <span class="n">dataf</span>
</span></code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="ref-ml-get_data-thermo.stages.get_data.get_data" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">get_data</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ref-ml-get_data-__codelineno-0-1"></a><span class="n">get_data</span><span class="p">(</span><span class="n">building_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">municipality</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">files</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
</span></code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Gets data for a specific building, municipality, and year from different sources
and outputs it as a single DataFrame.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>building_name</code></td>
          <td>
                <code><span data-autorefs-optional="str">str</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the building.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>municipality</code></td>
          <td>
                <code><span data-autorefs-optional="str">str</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the municipality.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>year</code></td>
          <td>
                <code><span data-autorefs-optional="int">int</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The target year.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>files</code></td>
          <td>
                <code><span data-autorefs-optional="list">list</span>[<span data-autorefs-optional="dict">dict</span>[<span data-autorefs-optional="str">str</span>, <span data-autorefs-optional-hover="typing.Any">Any</span>]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of file information and processing instructions.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span data-autorefs-optional-hover="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>pd.DataFrame: The merged DataFrame containing the data.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>thermo/stages/get_data.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#ref-ml-get_data-__codelineno-0-189">189</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-190">190</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-191">191</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-192">192</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-193">193</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-194">194</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-195">195</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-196">196</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-197">197</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-198">198</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-199">199</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-200">200</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-201">201</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-202">202</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-203">203</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-204">204</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-205">205</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-206">206</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-207">207</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-208">208</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-209">209</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-210">210</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-211">211</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-212">212</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-213">213</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-214">214</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-215">215</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-216">216</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-217">217</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-218">218</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-219">219</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-220">220</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-221">221</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-222">222</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-223">223</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-224">224</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-189"><a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span>
</span><span id="__span-0-190"><a id="__codelineno-0-190" name="__codelineno-0-190"></a>    <span class="n">building_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">municipality</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">files</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
</span><span id="__span-0-191"><a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="__span-0-192"><a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-193"><a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">    Gets data for a specific building, municipality, and year from different sources</span>
</span><span id="__span-0-194"><a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">    and outputs it as a single DataFrame.</span>
</span><span id="__span-0-195"><a id="__codelineno-0-195" name="__codelineno-0-195"></a>
</span><span id="__span-0-196"><a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">    Args:</span>
</span><span id="__span-0-197"><a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="sd">        building_name: The name of the building.</span>
</span><span id="__span-0-198"><a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">        municipality: The name of the municipality.</span>
</span><span id="__span-0-199"><a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="sd">        year: The target year.</span>
</span><span id="__span-0-200"><a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="sd">        files: List of file information and processing instructions.</span>
</span><span id="__span-0-201"><a id="__codelineno-0-201" name="__codelineno-0-201"></a>
</span><span id="__span-0-202"><a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">    Returns:</span>
</span><span id="__span-0-203"><a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">        pd.DataFrame: The merged DataFrame containing the data.</span>
</span><span id="__span-0-204"><a id="__codelineno-0-204" name="__codelineno-0-204"></a>
</span><span id="__span-0-205"><a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-206"><a id="__codelineno-0-206" name="__codelineno-0-206"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Getting data for building </span><span class="si">{</span><span class="n">building_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-0-207"><a id="__codelineno-0-207" name="__codelineno-0-207"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data for municipality </span><span class="si">{</span><span class="n">municipality</span><span class="si">}</span><span class="s2"> on year </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span id="__span-0-208"><a id="__codelineno-0-208" name="__codelineno-0-208"></a>
</span><span id="__span-0-209"><a id="__codelineno-0-209" name="__codelineno-0-209"></a>    <span class="n">dataf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="__span-0-210"><a id="__codelineno-0-210" name="__codelineno-0-210"></a>        <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">-01-01&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">-12-31&quot;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;H&quot;</span><span class="p">)</span>
</span><span id="__span-0-211"><a id="__codelineno-0-211" name="__codelineno-0-211"></a>    <span class="p">)</span>
</span><span id="__span-0-212"><a id="__codelineno-0-212" name="__codelineno-0-212"></a>    <span class="k">for</span> <span class="n">fileinfo</span> <span class="ow">in</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">RawDataFile</span><span class="p">(</span><span class="o">**</span><span class="n">x</span><span class="p">),</span> <span class="n">files</span><span class="p">):</span>
</span><span id="__span-0-213"><a id="__codelineno-0-213" name="__codelineno-0-213"></a>        <span class="n">dataf</span> <span class="o">=</span> <span class="n">dataf</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="__span-0-214"><a id="__codelineno-0-214" name="__codelineno-0-214"></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="__span-0-215"><a id="__codelineno-0-215" name="__codelineno-0-215"></a>            <span class="n">other</span><span class="o">=</span><span class="p">(</span>
</span><span id="__span-0-216"><a id="__codelineno-0-216" name="__codelineno-0-216"></a>                <span class="n">from_csv</span><span class="p">(</span>
</span><span id="__span-0-217"><a id="__codelineno-0-217" name="__codelineno-0-217"></a>                    <span class="n">file_path</span><span class="o">=</span><span class="n">WORKDIR</span> <span class="o">/</span> <span class="n">fileinfo</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span>
</span><span id="__span-0-218"><a id="__codelineno-0-218" name="__codelineno-0-218"></a>                    <span class="n">municipality</span><span class="o">=</span><span class="n">municipality</span><span class="p">,</span>
</span><span id="__span-0-219"><a id="__codelineno-0-219" name="__codelineno-0-219"></a>                    <span class="n">year</span><span class="o">=</span><span class="n">year</span><span class="p">,</span>
</span><span id="__span-0-220"><a id="__codelineno-0-220" name="__codelineno-0-220"></a>                <span class="p">)</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">select_data</span><span class="p">,</span> <span class="n">fileinfo</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">fileinfo</span><span class="o">.</span><span class="n">parse_params</span><span class="p">)</span>
</span><span id="__span-0-221"><a id="__codelineno-0-221" name="__codelineno-0-221"></a>            <span class="p">),</span>
</span><span id="__span-0-222"><a id="__codelineno-0-222" name="__codelineno-0-222"></a>        <span class="p">)</span>
</span><span id="__span-0-223"><a id="__codelineno-0-223" name="__codelineno-0-223"></a>
</span><span id="__span-0-224"><a id="__codelineno-0-224" name="__codelineno-0-224"></a>    <span class="k">return</span> <span class="n">dataf</span>
</span></code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="ref-ml-get_data-thermo.stages.get_data.select_bookings_data" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">select_bookings_data</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ref-ml-get_data-__codelineno-0-1"></a><span class="n">select_bookings_data</span><span class="p">(</span><span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="o">**</span><span class="n">parse_params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
</span></code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Selects data from the input bookings DataFrame based on specified parameters.
It can drop rooms that have never been dropped from the input DataFrame.
It aggregates bookings for the same room and timestamp using one of the
aggregation methods and sets "TIMESTAMP" as index.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>dataf</code></td>
          <td>
                <code><span data-autorefs-optional-hover="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The input data.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>**parse_params</code></td>
          <td>
                <code><span data-autorefs-optional="dict">dict</span>[<span data-autorefs-optional="str">str</span>, <span data-autorefs-optional-hover="typing.Any">Any</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Additional parameters for data parsing.</p>
            </div>
          </td>
          <td>
                <code>{}</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span data-autorefs-optional-hover="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The selected bookings data DataFrame.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>thermo/stages/get_data.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#ref-ml-get_data-__codelineno-0-126">126</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-127">127</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-128">128</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-129">129</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-130">130</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-131">131</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-132">132</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-133">133</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-134">134</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-135">135</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-136">136</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-137">137</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-138">138</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-139">139</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-140">140</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-141">141</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-142">142</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-143">143</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-144">144</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-145">145</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-146">146</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-147">147</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-148">148</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-149">149</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-150">150</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-151">151</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-152">152</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-153">153</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-154">154</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-155">155</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-156">156</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-157">157</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-158">158</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-159">159</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-160">160</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-161">161</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="k">def</span> <span class="nf">select_bookings_data</span><span class="p">(</span>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a>    <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="o">**</span><span class="n">parse_params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">    Selects data from the input bookings DataFrame based on specified parameters.</span>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">    It can drop rooms that have never been dropped from the input DataFrame.</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">    It aggregates bookings for the same room and timestamp using one of the</span>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">    aggregation methods and sets &quot;TIMESTAMP&quot; as index.</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">    Args:</span>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">        dataf: The input data.</span>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">        **parse_params: Additional parameters for data parsing.</span>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138"></a>
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">    Returns:</span>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">        The selected bookings data DataFrame.</span>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142"></a>    <span class="k">if</span> <span class="n">parse_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;drop_empty_rooms&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143"></a>        <span class="n">non_empty_rooms</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144"></a>            <span class="n">dataf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;ROOM_ID&quot;</span><span class="p">)[</span><span class="s2">&quot;BOOKED&quot;</span><span class="p">]</span>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145"></a>            <span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146"></a>            <span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">gt</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span>
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147"></a>            <span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="p">)</span>
</span><span id="__span-0-149"><a id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="n">dataf</span> <span class="o">=</span> <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;ROOM_ID&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">non_empty_rooms</span><span class="p">)]</span>
</span><span id="__span-0-150"><a id="__codelineno-0-150" name="__codelineno-0-150"></a>
</span><span id="__span-0-151"><a id="__codelineno-0-151" name="__codelineno-0-151"></a>    <span class="k">match</span> <span class="n">parse_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;aggregation_method&quot;</span><span class="p">,</span> <span class="s2">&quot;binary&quot;</span><span class="p">):</span>
</span><span id="__span-0-152"><a id="__codelineno-0-152" name="__codelineno-0-152"></a>        <span class="k">case</span> <span class="s2">&quot;binary&quot;</span><span class="p">:</span>
</span><span id="__span-0-153"><a id="__codelineno-0-153" name="__codelineno-0-153"></a>            <span class="n">dataf</span> <span class="o">=</span> <span class="n">dataf</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">binary_aggregate_bookings</span><span class="p">)</span>
</span><span id="__span-0-154"><a id="__codelineno-0-154" name="__codelineno-0-154"></a>        <span class="k">case</span> <span class="s2">&quot;fractional&quot;</span><span class="p">:</span>
</span><span id="__span-0-155"><a id="__codelineno-0-155" name="__codelineno-0-155"></a>            <span class="n">dataf</span> <span class="o">=</span> <span class="n">dataf</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">fractional_aggregate_bookings</span><span class="p">)</span>
</span><span id="__span-0-156"><a id="__codelineno-0-156" name="__codelineno-0-156"></a>        <span class="k">case</span> <span class="n">other</span><span class="p">:</span>
</span><span id="__span-0-157"><a id="__codelineno-0-157" name="__codelineno-0-157"></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Aggregation method </span><span class="si">{</span><span class="n">other</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span id="__span-0-158"><a id="__codelineno-0-158" name="__codelineno-0-158"></a>
</span><span id="__span-0-159"><a id="__codelineno-0-159" name="__codelineno-0-159"></a>    <span class="k">return</span> <span class="n">dataf</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s2">&quot;TIMESTAMP&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;ROOM_ID&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s2">&quot;BOOKED&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="__span-0-160"><a id="__codelineno-0-160" name="__codelineno-0-160"></a>        <span class="n">columns</span><span class="o">=</span><span class="k">lambda</span> <span class="n">name</span><span class="p">:</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_booked&quot;</span>
</span><span id="__span-0-161"><a id="__codelineno-0-161" name="__codelineno-0-161"></a>    <span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="ref-ml-get_data-thermo.stages.get_data.select_data" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">select_data</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ref-ml-get_data-__codelineno-0-1"></a><span class="n">select_data</span><span class="p">(</span><span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">parse_params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
</span></code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Selects and cleans a specific dataset based on the type of data
(i.e. energy, bookings) and parsing parameters.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>dataf</code></td>
          <td>
                <code><span data-autorefs-optional-hover="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The input data.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>name</code></td>
          <td>
                <code><span data-autorefs-optional="str">str</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the kind of data (i.e. energy, bookings)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>**parse_params</code></td>
          <td>
                <code><span data-autorefs-optional="dict">dict</span>[<span data-autorefs-optional="str">str</span>, <span data-autorefs-optional-hover="typing.Any">Any</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Additional parameters for data parsing.</p>
            </div>
          </td>
          <td>
                <code>{}</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span data-autorefs-optional-hover="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The selected and cleaned DataFrame.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span data-autorefs-optional="NotImplementedError">NotImplementedError</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If a handler for the given file name is not implemented.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>thermo/stages/get_data.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#ref-ml-get_data-__codelineno-0-66">66</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-67">67</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-68">68</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-69">69</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-70">70</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-71">71</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-72">72</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-73">73</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-74">74</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-75">75</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-76">76</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-77">77</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-78">78</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-79">79</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-80">80</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-81">81</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-82">82</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-83">83</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-84">84</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-85">85</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-86">86</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-87">87</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-88">88</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-89">89</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-90">90</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="k">def</span> <span class="nf">select_data</span><span class="p">(</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a>    <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">parse_params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Selects and cleans a specific dataset based on the type of data</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">    (i.e. energy, bookings) and parsing parameters.</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">    Args:</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        dataf: The input data.</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        name: The name of the kind of data (i.e. energy, bookings)</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">        **parse_params: Additional parameters for data parsing.</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">    Returns:</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">        The selected and cleaned DataFrame.</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">    Raises:</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        NotImplementedError: If a handler for the given file name is not implemented.</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Select and transform </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> data&quot;</span><span class="p">)</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="k">match</span> <span class="n">name</span><span class="p">:</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="k">case</span> <span class="s2">&quot;energy&quot;</span><span class="p">:</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a>            <span class="k">return</span> <span class="n">select_energy_data</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="o">**</span><span class="n">parse_params</span><span class="p">)</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="k">case</span> <span class="s2">&quot;bookings&quot;</span><span class="p">:</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a>            <span class="k">return</span> <span class="n">select_bookings_data</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="o">**</span><span class="n">parse_params</span><span class="p">)</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a>        <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Handler for file name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> not implemented&quot;</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="ref-ml-get_data-thermo.stages.get_data.select_energy_data" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">select_energy_data</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ref-ml-get_data-__codelineno-0-1"></a><span class="n">select_energy_data</span><span class="p">(</span><span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="o">**</span><span class="n">parse_params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
</span></code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Selects data from the input energy DataFrame based on specified parameters;
as for example measure points or measure types (i.e. electricity).</p>
<p>Note this flexibility is needed since "electricity" can be spelled in different
ways for different schools.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>dataf</code></td>
          <td>
                <code><span data-autorefs-optional-hover="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The input data.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>**parse_params</code></td>
          <td>
                <code><span data-autorefs-optional="dict">dict</span>[<span data-autorefs-optional="str">str</span>, <span data-autorefs-optional-hover="typing.Any">Any</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Additional parameters for data parsing.</p>
            </div>
          </td>
          <td>
                <code>{}</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span data-autorefs-optional-hover="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The clean energy data DataFrame with "TIMESTAMP" as index.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span data-autorefs-optional="NotImplementedError">NotImplementedError</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If handling for more than one measure point or type</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>thermo/stages/get_data.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#ref-ml-get_data-__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-100">100</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-101">101</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-102">102</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-103">103</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-104">104</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-105">105</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-106">106</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-107">107</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-108">108</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-109">109</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-110">110</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-111">111</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-112">112</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-113">113</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-114">114</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-115">115</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-116">116</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-117">117</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-118">118</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-119">119</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-120">120</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-121">121</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-122">122</a></span>
<span class="normal"><a href="#ref-ml-get_data-__codelineno-0-123">123</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="k">def</span> <span class="nf">select_energy_data</span><span class="p">(</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="o">**</span><span class="n">parse_params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">    Selects data from the input energy DataFrame based on specified parameters;</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">    as for example measure points or measure types (i.e. electricity).</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">    Note this flexibility is needed since &quot;electricity&quot; can be spelled in different</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">    ways for different schools.</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">    Args:</span>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">        dataf: The input data.</span>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">        **parse_params: Additional parameters for data parsing.</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">    Returns:</span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">        The clean energy data DataFrame with &quot;TIMESTAMP&quot; as index.</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">    Raises:</span>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">        NotImplementedError: If handling for more than one measure point or type</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">        is not implemented.</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="n">measure_points</span> <span class="o">=</span> <span class="n">parse_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;measure_points&quot;</span><span class="p">,</span> <span class="n">dataf</span><span class="p">[</span><span class="s2">&quot;MEASURE_POINT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="n">measure_types</span> <span class="o">=</span> <span class="n">parse_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;measure_types&quot;</span><span class="p">,</span> <span class="n">dataf</span><span class="p">[</span><span class="s2">&quot;MEASURE_TYPE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">measure_points</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">measure_types</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Handling for more than one measure point or type.&quot;</span><span class="p">)</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="k">return</span> <span class="p">(</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a>        <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;MEASURE_POINT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">measure_points</span><span class="p">)]</span>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a>        <span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;MEASURE_TYPE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">measure_types</span><span class="p">)]</span>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;TIMESTAMP&quot;</span><span class="p">)</span>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a>        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;VALUE&quot;</span><span class="p">:</span> <span class="s2">&quot;electricity&quot;</span><span class="p">})[[</span><span class="s2">&quot;electricity&quot;</span><span class="p">]]</span>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div></section><section class="print-page" id="ref-ml-preprocessing"><h1 id="ref-ml-preprocessing-preprocessingpy">preprocessing.py</h1>


<div class="doc doc-object doc-module">



<a id="thermo.stages.preprocessing"></a>
  <div class="doc doc-contents first">
  
      <p>This script takes care of the feature engineering:
it produces the insights we know are there so they
can be fed to the machine learning algorithm in the next step.</p>
<p>It takes in the raw bookings and does two main tasks:
- Drops data that is not interesting
- Feature engineering: simulates the ventilation system.</p>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h2 id="ref-ml-preprocessing-thermo.stages.preprocessing.drop_nights_and_school" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">drop_nights_and_school</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ref-ml-preprocessing-__codelineno-0-1"></a><span class="n">drop_nights_and_school</span><span class="p">(</span><span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">drop</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
</span></code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Drops nights and school hours from the DataFrame.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>dataf</code></td>
          <td>
                <code><span data-autorefs-optional-hover="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The input DataFrame.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>drop</code></td>
          <td>
                <code><span data-autorefs-optional="bool">bool</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Indicates whether to drop nights and school days.
If False, no data is dropped. Defaults to True.</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span data-autorefs-optional-hover="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The processed DataFrame.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>thermo/stages/preprocessing.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-100">100</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-101">101</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-102">102</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-103">103</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-104">104</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-105">105</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-106">106</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-107">107</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-108">108</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-109">109</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-110">110</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-111">111</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-112">112</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-113">113</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-114">114</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-115">115</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-116">116</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-117">117</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-118">118</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="nd">@log_transformation</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="k">def</span> <span class="nf">drop_nights_and_school</span><span class="p">(</span><span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">drop</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Drops nights and school hours from the DataFrame.</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">    Args:</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">        dataf: The input DataFrame.</span>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">        drop: Indicates whether to drop nights and school days.</span>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">            If False, no data is dropped. Defaults to True.</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">    Returns:</span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">        The processed DataFrame.</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">drop</span><span class="p">:</span>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="k">return</span> <span class="n">dataf</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="n">v_schoolday</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">is_schoolday</span><span class="p">)</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="n">schoolday</span> <span class="o">=</span> <span class="n">v_schoolday</span><span class="p">(</span><span class="n">dataf</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>  <span class="c1"># type: ignore[attr-defined]</span>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="n">hour</span> <span class="o">=</span> <span class="n">dataf</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">hour</span>  <span class="c1"># type: ignore[attr-defined]</span>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="k">return</span> <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="p">(</span><span class="n">schoolday</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">hour</span> <span class="o">&gt;=</span> <span class="n">WEEKDAY_HOUR_START</span><span class="p">))</span>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a>        <span class="o">|</span> <span class="p">(</span><span class="o">~</span><span class="n">schoolday</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">hour</span> <span class="o">&gt;=</span> <span class="n">WEEKEND_HOUR_START</span><span class="p">))</span>  <span class="c1"># noqa W503</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="p">]</span>
</span></code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="ref-ml-preprocessing-thermo.stages.preprocessing.drop_unfrequent_rooms" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">drop_unfrequent_rooms</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ref-ml-preprocessing-__codelineno-0-1"></a><span class="n">drop_unfrequent_rooms</span><span class="p">(</span><span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
</span></code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Drops the columns for rooms with low booking frequency from the DataFrame.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>dataf</code></td>
          <td>
                <code><span data-autorefs-optional-hover="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The input DataFrame.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>threshold</code></td>
          <td>
                <code><span data-autorefs-optional="int">int</span> | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Rooms with less bookings than this threshold will be dropped.
If None, no rooms are dropped.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span data-autorefs-optional-hover="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The DataFrame with the columns with infrequent rooms dropped.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>thermo/stages/preprocessing.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-51">51</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-52">52</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-53">53</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-54">54</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-55">55</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-56">56</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-57">57</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-58">58</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-59">59</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-60">60</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-61">61</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-62">62</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-63">63</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-64">64</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-65">65</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-66">66</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-67">67</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-68">68</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-69">69</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-70">70</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-71">71</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="nd">@log_transformation</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="k">def</span> <span class="nf">drop_unfrequent_rooms</span><span class="p">(</span><span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">    Drops the columns for rooms with low booking frequency from the DataFrame.</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">    Args:</span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">        dataf: The input DataFrame.</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">        threshold: Rooms with less bookings than this threshold will be dropped.</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">            If None, no rooms are dropped.</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">    Returns:</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">        The DataFrame with the columns with infrequent rooms dropped.</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">threshold</span><span class="p">:</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a>        <span class="k">return</span> <span class="n">dataf</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a>    <span class="n">room_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dataf</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;booked&quot;</span><span class="p">)]</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="n">to_drop</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a>        <span class="n">dataf</span><span class="p">[</span><span class="n">room_columns</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">lt</span><span class="p">(</span><span class="n">threshold</span><span class="p">)]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="p">)</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span class="k">return</span> <span class="n">dataf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">to_drop</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="ref-ml-preprocessing-thermo.stages.preprocessing.drop_unused_days" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">drop_unused_days</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ref-ml-preprocessing-__codelineno-0-1"></a><span class="n">drop_unused_days</span><span class="p">(</span><span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
</span></code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Drops the rows corresponding to days where no room was used from the DataFrame.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>dataf</code></td>
          <td>
                <code><span data-autorefs-optional-hover="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The input DataFrame.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span data-autorefs-optional-hover="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The DataFrame with the days where no room was used dropped.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>thermo/stages/preprocessing.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-74">74</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-75">75</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-76">76</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-77">77</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-78">78</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-79">79</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-80">80</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-81">81</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-82">82</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-83">83</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-84">84</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-85">85</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-86">86</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-87">87</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-88">88</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-89">89</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-90">90</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-91">91</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-92">92</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-93">93</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-94">94</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-95">95</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="nd">@log_transformation</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="k">def</span> <span class="nf">drop_unused_days</span><span class="p">(</span><span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">    Drops the rows corresponding to days where no room was used from the DataFrame.</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    Args:</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">        dataf: The input DataFrame.</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">    Returns:</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">        The DataFrame with the days where no room was used dropped.</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a>    <span class="n">room_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dataf</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;booked&quot;</span><span class="p">)]</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="n">is_used</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="n">dataf</span><span class="p">[</span><span class="n">room_columns</span><span class="p">]</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">dataf</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">date</span><span class="p">])</span>  <span class="c1"># type: ignore[attr-defined]</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a>        <span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a>        <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a>        <span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="o">.</span><span class="fm">__getitem__</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="p">)</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a>    <span class="k">return</span> <span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">is_used</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">date</span><span class="p">)]</span>  <span class="c1"># type: ignore[attr-defined]</span>
</span></code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="ref-ml-preprocessing-thermo.stages.preprocessing.log_transformation" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">log_transformation</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ref-ml-preprocessing-__codelineno-0-1"></a><span class="n">log_transformation</span><span class="p">(</span><span class="n">func</span><span class="p">:</span> <span class="n">Transformation</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Transformation</span>
</span></code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Time logger for preprocessing transformations</p>

          <details class="quote">
            <summary>Source code in <code>thermo/stages/preprocessing.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-26">26</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-27">27</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-28">28</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-29">29</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-30">30</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-31">31</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-32">32</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-33">33</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-34">34</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-35">35</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-36">36</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-37">37</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-38">38</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-39">39</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-40">40</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-41">41</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-42">42</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-43">43</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-44">44</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-45">45</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-46">46</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-47">47</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-48">48</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="k">def</span> <span class="nf">log_transformation</span><span class="p">(</span><span class="n">func</span><span class="p">:</span> <span class="n">Transformation</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Transformation</span><span class="p">:</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">    Time logger for preprocessing transformations</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a>    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a>    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a>        <span class="n">params</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> running </span><span class="se">\t</span><span class="s2"> parameters: </span><span class="si">{</span><span class="n">params</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a>        <span class="n">tic</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">dataf</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a>        <span class="n">time_taken</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">tic</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> completed </span><span class="se">\t</span><span class="s2"> shape </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> time </span><span class="si">{</span><span class="n">time_taken</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">s&quot;</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a>        <span class="p">)</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> emptied the DataFrame&quot;</span><span class="p">)</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a>    <span class="k">return</span> <span class="n">wrapper</span>
</span></code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="ref-ml-preprocessing-thermo.stages.preprocessing.mock_ventilation" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">mock_ventilation</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ref-ml-preprocessing-__codelineno-0-1"></a><span class="n">mock_ventilation</span><span class="p">(</span><span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
</span></code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Mocks ventilation data based on booking information.
params = {is_on:True} results in one hot encoding of
whether the ventilation is on, and {is_day:True} results
in a distinction between if the room was booked or it wasn't
but the ventilation is in day mode.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>dataf</code></td>
          <td>
                <code><span data-autorefs-optional-hover="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The input DataFrame.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>params</code></td>
          <td>
                <code><span data-autorefs-optional="dict">dict</span>[<span data-autorefs-optional="str">str</span>, <span data-autorefs-optional-hover="typing.Any">Any</span>] | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Parameters for ventilation mocking.
If None, no mocking is performed.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span data-autorefs-optional-hover="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The DataFrame with mocked ventilation data.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>thermo/stages/preprocessing.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-121">121</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-122">122</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-123">123</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-124">124</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-125">125</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-126">126</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-127">127</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-128">128</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-129">129</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-130">130</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-131">131</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-132">132</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-133">133</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-134">134</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-135">135</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-136">136</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-137">137</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-138">138</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-139">139</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-140">140</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-141">141</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-142">142</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-143">143</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-144">144</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-145">145</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-146">146</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-147">147</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-148">148</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-149">149</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-150">150</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-151">151</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-152">152</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-153">153</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-154">154</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-155">155</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-156">156</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-157">157</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-158">158</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-159">159</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-160">160</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-161">161</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-162">162</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-163">163</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-164">164</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-165">165</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-166">166</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-167">167</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-168">168</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-169">169</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-170">170</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-171">171</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-172">172</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="nd">@log_transformation</span>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="k">def</span> <span class="nf">mock_ventilation</span><span class="p">(</span>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Mocks ventilation data based on booking information.</span>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">    params = {is_on:True} results in one hot encoding of</span>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">    whether the ventilation is on, and {is_day:True} results</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">    in a distinction between if the room was booked or it wasn&#39;t</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">    but the ventilation is in day mode.</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">    Args:</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">        dataf: The input DataFrame.</span>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">        params: Parameters for ventilation mocking.</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">            If None, no mocking is performed.</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">    Returns:</span>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">        The DataFrame with mocked ventilation data.</span>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139"></a>    <span class="c1"># If there are no parameters, do nothing</span>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">params</span><span class="p">:</span>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="k">return</span> <span class="n">dataf</span>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142"></a>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143"></a>    <span class="c1"># Extract flags from params</span>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144"></a>    <span class="n">is_on</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;is_on&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145"></a>    <span class="n">is_day</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;is_day&quot;</span><span class="p">,</span> <span class="ow">not</span> <span class="n">is_on</span><span class="p">)</span>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146"></a>
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147"></a>    <span class="c1"># Deal with corner cases</span>
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_on</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_day</span><span class="p">:</span>
</span><span id="__span-0-149"><a id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="k">return</span> <span class="n">dataf</span>
</span><span id="__span-0-150"><a id="__codelineno-0-150" name="__codelineno-0-150"></a>    <span class="k">elif</span> <span class="n">is_on</span> <span class="ow">and</span> <span class="n">is_day</span><span class="p">:</span>
</span><span id="__span-0-151"><a id="__codelineno-0-151" name="__codelineno-0-151"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Both is_day and is_on cannot be True at the same time.&quot;</span><span class="p">)</span>
</span><span id="__span-0-152"><a id="__codelineno-0-152" name="__codelineno-0-152"></a>
</span><span id="__span-0-153"><a id="__codelineno-0-153" name="__codelineno-0-153"></a>    <span class="c1"># Get room names</span>
</span><span id="__span-0-154"><a id="__codelineno-0-154" name="__codelineno-0-154"></a>    <span class="n">room_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dataf</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;booked&quot;</span><span class="p">)]</span>
</span><span id="__span-0-155"><a id="__codelineno-0-155" name="__codelineno-0-155"></a>    <span class="n">bookings</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">room_columns</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="__span-0-156"><a id="__codelineno-0-156" name="__codelineno-0-156"></a>
</span><span id="__span-0-157"><a id="__codelineno-0-157" name="__codelineno-0-157"></a>    <span class="n">ventilation</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-158"><a id="__codelineno-0-158" name="__codelineno-0-158"></a>        <span class="n">bookings</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">bookings</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">date</span><span class="p">])</span>  <span class="c1"># type: ignore[attr-defined]</span>
</span><span id="__span-0-159"><a id="__codelineno-0-159" name="__codelineno-0-159"></a>        <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">iloc</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">cummax</span><span class="p">()</span><span class="o">.</span><span class="n">iloc</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span>
</span><span id="__span-0-160"><a id="__codelineno-0-160" name="__codelineno-0-160"></a>        <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-161"><a id="__codelineno-0-161" name="__codelineno-0-161"></a>        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">&quot;level_0&quot;</span><span class="p">)</span>
</span><span id="__span-0-162"><a id="__codelineno-0-162" name="__codelineno-0-162"></a>    <span class="p">)</span>
</span><span id="__span-0-163"><a id="__codelineno-0-163" name="__codelineno-0-163"></a>    <span class="c1"># Add is_day column per room</span>
</span><span id="__span-0-164"><a id="__codelineno-0-164" name="__codelineno-0-164"></a>    <span class="k">if</span> <span class="n">is_day</span><span class="p">:</span>
</span><span id="__span-0-165"><a id="__codelineno-0-165" name="__codelineno-0-165"></a>        <span class="n">ventilation</span> <span class="o">=</span> <span class="n">dataf</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="__span-0-166"><a id="__codelineno-0-166" name="__codelineno-0-166"></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="__span-0-167"><a id="__codelineno-0-167" name="__codelineno-0-167"></a>            <span class="n">other</span><span class="o">=</span><span class="p">(</span><span class="n">ventilation</span> <span class="o">-</span> <span class="n">bookings</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="__span-0-168"><a id="__codelineno-0-168" name="__codelineno-0-168"></a>                <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="n">col</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_booked&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_day&quot;</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">room_columns</span><span class="p">}</span>
</span><span id="__span-0-169"><a id="__codelineno-0-169" name="__codelineno-0-169"></a>            <span class="p">),</span>
</span><span id="__span-0-170"><a id="__codelineno-0-170" name="__codelineno-0-170"></a>        <span class="p">)</span>
</span><span id="__span-0-171"><a id="__codelineno-0-171" name="__codelineno-0-171"></a>
</span><span id="__span-0-172"><a id="__codelineno-0-172" name="__codelineno-0-172"></a>    <span class="k">return</span> <span class="n">ventilation</span>
</span></code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="ref-ml-preprocessing-thermo.stages.preprocessing.preprocess" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">preprocess</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ref-ml-preprocessing-__codelineno-0-1"></a><span class="n">preprocess</span><span class="p">(</span><span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
</span></code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Preprocesses the data based on the given parameters.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>dataf</code></td>
          <td>
                <code><span data-autorefs-optional-hover="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The input DataFrame.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>params</code></td>
          <td>
                <code><span data-autorefs-optional="dict">dict</span>[<span data-autorefs-optional="str">str</span>, <span data-autorefs-optional-hover="typing.Any">Any</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Parameters for data preprocessing.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span data-autorefs-optional-hover="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>pd.DataFrame: The preprocessed DataFrame.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>thermo/stages/preprocessing.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-175">175</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-176">176</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-177">177</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-178">178</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-179">179</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-180">180</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-181">181</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-182">182</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-183">183</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-184">184</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-185">185</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-186">186</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-187">187</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-188">188</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-189">189</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-190">190</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-191">191</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-192">192</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-193">193</a></span>
<span class="normal"><a href="#ref-ml-preprocessing-__codelineno-0-194">194</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-175"><a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="k">def</span> <span class="nf">preprocess</span><span class="p">(</span><span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="__span-0-176"><a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-177"><a id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="sd">    Preprocesses the data based on the given parameters.</span>
</span><span id="__span-0-178"><a id="__codelineno-0-178" name="__codelineno-0-178"></a>
</span><span id="__span-0-179"><a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="sd">    Args:</span>
</span><span id="__span-0-180"><a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">        dataf: The input DataFrame.</span>
</span><span id="__span-0-181"><a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">        params: Parameters for data preprocessing.</span>
</span><span id="__span-0-182"><a id="__codelineno-0-182" name="__codelineno-0-182"></a>
</span><span id="__span-0-183"><a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">    Returns:</span>
</span><span id="__span-0-184"><a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">        pd.DataFrame: The preprocessed DataFrame.</span>
</span><span id="__span-0-185"><a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-186"><a id="__codelineno-0-186" name="__codelineno-0-186"></a>    <span class="k">return</span> <span class="p">(</span>
</span><span id="__span-0-187"><a id="__codelineno-0-187" name="__codelineno-0-187"></a>        <span class="n">dataf</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">drop_unused_days</span><span class="p">)</span>
</span><span id="__span-0-188"><a id="__codelineno-0-188" name="__codelineno-0-188"></a>        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">drop_unfrequent_rooms</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;booking_hours_threshold&quot;</span><span class="p">))</span>
</span><span id="__span-0-189"><a id="__codelineno-0-189" name="__codelineno-0-189"></a>        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span>
</span><span id="__span-0-190"><a id="__codelineno-0-190" name="__codelineno-0-190"></a>            <span class="n">drop_nights_and_school</span><span class="p">,</span>
</span><span id="__span-0-191"><a id="__codelineno-0-191" name="__codelineno-0-191"></a>            <span class="n">drop</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;drop_nights_and_school_hours&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
</span><span id="__span-0-192"><a id="__codelineno-0-192" name="__codelineno-0-192"></a>        <span class="p">)</span>
</span><span id="__span-0-193"><a id="__codelineno-0-193" name="__codelineno-0-193"></a>        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">mock_ventilation</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ventilation&quot;</span><span class="p">))</span>
</span><span id="__span-0-194"><a id="__codelineno-0-194" name="__codelineno-0-194"></a>    <span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div></section><section class="print-page" id="ref-ml-train"><h1 id="ref-ml-train-trainpy">train.py</h1>


<div class="doc doc-object doc-module">



<a id="thermo.stages.train"></a>
  <div class="doc doc-contents first">
  
      <p>Train a linear regression to extract the cost of booking each
room from the data. The model is trained using n-fold cross validation
and grid search to decide the value of the L2 regularization
that best fits the data.</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">




<h2 id="ref-ml-train-thermo.stages.train.CVResult" class="doc doc-heading">
          <span class="doc doc-object-name doc-class-name">CVResult</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">

  
      <p>Class representing the results of cross-validation.</p>



  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>name</code></td>
          <td>
                <code><span data-autorefs-optional="str">str</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the model.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>estimator</code></td>
          <td>
                <code><span data-autorefs-optional-hover="sklearn.base.RegressorMixin">RegressorMixin</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The fitted estimator.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>cv_results</code></td>
          <td>
                <code><span data-autorefs-optional-hover="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The cross-validation results.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>r2_score</code></td>
          <td>
                <code><span data-autorefs-optional="float">float</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The R-squared score.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>l2_weight</code></td>
          <td>
                <code><span data-autorefs-optional="float">float</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The L2 weight.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Methods:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
          <tr>
            <td><code>__repr__</code></td>
            <td>
              <div class="doc-md-description">
                <p>Returns a string representation of the CVResult object.</p>
              </div>
            </td>
          </tr>
    </tbody>
  </table>


  

  <div class="doc doc-children">











  </div>

  </div>

</div>



<div class="doc doc-object doc-function">




<h2 id="ref-ml-train-thermo.stages.train.get_estimator" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">get_estimator</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ref-ml-train-__codelineno-0-1"></a><span class="n">get_estimator</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RegressorMixin</span>
</span></code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Returns a sklearn estimator based on the given name.</p>

<details class="note" open>
  <summary>this function is ready to take other linear models</summary>
  <p>but we havent implemented that yet.</p>
</details>


  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>name</code></td>
          <td>
                <code><span data-autorefs-optional="str">str</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the estimator.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span data-autorefs-optional-hover="sklearn.base.RegressorMixin">RegressorMixin</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The corresponding sklearn estimator.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span data-autorefs-optional="NameError">NameError</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If the estimator name is not supported.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>thermo/stages/train.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#ref-ml-train-__codelineno-0-18">18</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-19">19</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-20">20</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-21">21</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-22">22</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-23">23</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-24">24</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-25">25</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-26">26</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-27">27</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-28">28</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-29">29</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-30">30</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-31">31</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-32">32</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-33">33</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-34">34</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-35">35</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-36">36</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-37">37</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-38">38</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-39">39</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-40">40</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="k">def</span> <span class="nf">get_estimator</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RegressorMixin</span><span class="p">:</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">    Returns a sklearn estimator based on the given name.</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">    Note: this function is ready to take other linear models</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">        but we havent implemented that yet.</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">    Args:</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">        name: The name of the estimator.</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">    Returns:</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">        The corresponding sklearn estimator.</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    Raises:</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">        NameError: If the estimator name is not supported.</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a>    <span class="k">match</span> <span class="n">name</span><span class="p">:</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a>        <span class="k">case</span> <span class="s2">&quot;RidgeRegression&quot;</span><span class="p">:</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a>            <span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Ridge</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a>            <span class="k">return</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a>        <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a>            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Estimator </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> is not supported&quot;</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="ref-ml-train-thermo.stages.train.get_feature_targets" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">get_feature_targets</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ref-ml-train-__codelineno-0-1"></a><span class="n">get_feature_targets</span><span class="p">(</span><span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">]</span>
</span></code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Splits the DataFrame into feature matrix X and target vector y.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>dataf</code></td>
          <td>
                <code><span data-autorefs-optional-hover="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The input DataFrame.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>target</code></td>
          <td>
                <code><span data-autorefs-optional="str">str</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the target column.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>tuple</code></td>          <td>
                <code><span data-autorefs-optional="tuple">tuple</span>[<span data-autorefs-optional-hover="pandas.DataFrame">DataFrame</span>, <span data-autorefs-optional-hover="pandas.Series">Series</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A tuple containing the feature matrix X
and the target vector y.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>thermo/stages/train.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#ref-ml-train-__codelineno-0-43">43</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-44">44</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-45">45</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-46">46</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-47">47</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-48">48</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-49">49</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-50">50</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-51">51</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-52">52</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-53">53</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-54">54</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-55">55</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-56">56</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-57">57</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-58">58</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-59">59</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-60">60</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="k">def</span> <span class="nf">get_feature_targets</span><span class="p">(</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a>    <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">]:</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">    Splits the DataFrame into feature matrix X and target vector y.</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">    Args:</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">        dataf: The input DataFrame.</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">        target: The name of the target column.</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">    Returns:</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">        tuple: A tuple containing the feature matrix X</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">            and the target vector y.</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a>    <span class="n">dataf</span> <span class="o">=</span> <span class="n">dataf</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>  <span class="c1"># Shuffle</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a>    <span class="n">y</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="n">X</span> <span class="o">=</span> <span class="n">dataf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">target</span><span class="p">)</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span>
</span></code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="ref-ml-train-thermo.stages.train.train_cv" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">train_cv</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ref-ml-train-__codelineno-0-1"></a><span class="n">train_cv</span><span class="p">(</span><span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">estimator_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;RidgeRegression&#39;</span><span class="p">,</span> <span class="n">cv_folds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">alpha_min</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span> <span class="n">alpha_max</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">_</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CVResult</span>
</span></code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Trains a ML regression model and finds the optimal L2 regularization coefficient
(alpha) using cross-validation.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>X</code></td>
          <td>
                <code><span data-autorefs-optional-hover="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The feature matrix.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>y</code></td>
          <td>
                <code><span data-autorefs-optional-hover="pandas.Series">Series</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The target vector.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>estimator_name</code></td>
          <td>
                <code><span data-autorefs-optional="str">str</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the estimator to use. Defaults to "RidgeRegression".</p>
            </div>
          </td>
          <td>
                <code>&#39;RidgeRegression&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>cv_folds</code></td>
          <td>
                <code><span data-autorefs-optional="int">int</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The number of cross-validation folds. Defaults to 5.</p>
            </div>
          </td>
          <td>
                <code>5</code>
          </td>
        </tr>
        <tr>
          <td><code>alpha_min</code></td>
          <td>
                <code><span data-autorefs-optional="float">float</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The minimum alpha value for hyperparameter search. Defaults to 0.001.</p>
            </div>
          </td>
          <td>
                <code>0.001</code>
          </td>
        </tr>
        <tr>
          <td><code>alpha_max</code></td>
          <td>
                <code><span data-autorefs-optional="float">float</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The maximum alpha value for hyperparameter search. Defaults to 1.</p>
            </div>
          </td>
          <td>
                <code>1</code>
          </td>
        </tr>
        <tr>
          <td><code>**_</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Optional additional keyword arguments (ignored).</p>
            </div>
          </td>
          <td>
                <code>{}</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>CVResult</code></td>          <td>
                <code><span data-autorefs-optional-hover="thermo.stages.train.CVResult">CVResult</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The cross-validation results.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="note" open>
  <summary>Note</summary>
  <p>The function performs a grid search to find the best
hyperparameters for the specified estimator.</p>
</details>
          <details class="quote">
            <summary>Source code in <code>thermo/stages/train.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#ref-ml-train-__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-100">100</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-101">101</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-102">102</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-103">103</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-104">104</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-105">105</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-106">106</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-107">107</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-108">108</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-109">109</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-110">110</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-111">111</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-112">112</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-113">113</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-114">114</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-115">115</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-116">116</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-117">117</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-118">118</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-119">119</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-120">120</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-121">121</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-122">122</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-123">123</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-124">124</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-125">125</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-126">126</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-127">127</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-128">128</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-129">129</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-130">130</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-131">131</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-132">132</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-133">133</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-134">134</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-135">135</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-136">136</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-137">137</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-138">138</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-139">139</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-140">140</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-141">141</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-142">142</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-143">143</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-144">144</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-145">145</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-146">146</a></span>
<span class="normal"><a href="#ref-ml-train-__codelineno-0-147">147</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="k">def</span> <span class="nf">train_cv</span><span class="p">(</span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a>    <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="n">y</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a>    <span class="n">estimator_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;RidgeRegression&quot;</span><span class="p">,</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a>    <span class="n">cv_folds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="n">alpha_min</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="n">alpha_max</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="o">**</span><span class="n">_</span><span class="p">,</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CVResult</span><span class="p">:</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">    Trains a ML regression model and finds the optimal L2 regularization coefficient</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">    (alpha) using cross-validation.</span>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">    Args:</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">        X: The feature matrix.</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">        y: The target vector.</span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">        estimator_name: The name of the estimator to use. Defaults to &quot;RidgeRegression&quot;.</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">        cv_folds: The number of cross-validation folds. Defaults to 5.</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">        alpha_min: The minimum alpha value for hyperparameter search. Defaults to 0.001.</span>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">        alpha_max: The maximum alpha value for hyperparameter search. Defaults to 1.</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">        **_: Optional additional keyword arguments (ignored).</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">    Returns:</span>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">        CVResult: The cross-validation results.</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">    Note:</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">        The function performs a grid search to find the best</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">        hyperparameters for the specified estimator.</span>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a>    <span class="c1"># Get hyperparameters range</span>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a>    <span class="n">log_min</span><span class="p">,</span> <span class="n">log_max</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">,</span> <span class="p">(</span><span class="n">alpha_min</span><span class="p">,</span> <span class="n">alpha_max</span><span class="p">)))</span>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="n">alphas</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a>        <span class="n">log_min</span><span class="p">,</span> <span class="n">log_max</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">log_max</span> <span class="o">-</span> <span class="n">log_min</span><span class="p">),</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a>    <span class="p">)</span>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a>    <span class="c1"># Find parameters and hyperparameters</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="n">cv</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a>        <span class="n">estimator</span><span class="o">=</span><span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;regression&quot;</span><span class="p">,</span> <span class="n">get_estimator</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">estimator_name</span><span class="p">))]),</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a>        <span class="n">param_grid</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;regression__alpha&quot;</span><span class="p">:</span> <span class="n">alphas</span><span class="p">},</span>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a>        <span class="n">cv</span><span class="o">=</span><span class="n">cv_folds</span><span class="p">,</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a>        <span class="n">scoring</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;r2&quot;</span><span class="p">,</span> <span class="s2">&quot;neg_root_mean_squared_error&quot;</span><span class="p">],</span>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="n">refit</span><span class="o">=</span><span class="s2">&quot;r2&quot;</span><span class="p">,</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a>        <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a>        <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="p">)</span>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138"></a>
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139"></a>    <span class="n">cv</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140"></a>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141"></a>    <span class="k">return</span> <span class="n">CVResult</span><span class="p">(</span>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142"></a>        <span class="n">estimator</span><span class="o">=</span><span class="n">cv</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">,</span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143"></a>        <span class="n">cv_results</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cv</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">),</span>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144"></a>        <span class="n">r2_score</span><span class="o">=</span><span class="n">cv</span><span class="o">.</span><span class="n">best_score_</span><span class="p">,</span>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145"></a>        <span class="n">l2_weight</span><span class="o">=</span><span class="n">cv</span><span class="o">.</span><span class="n">best_params_</span><span class="p">[</span><span class="s2">&quot;regression__alpha&quot;</span><span class="p">],</span>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="n">name</span><span class="o">=</span><span class="n">estimator_name</span><span class="p">,</span>
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147"></a>    <span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div></section><section class="print-page" id="ref-ml-evaluate"><h1 id="ref-ml-evaluate-evaluate_modelpy">evaluate_model.py</h1>


<div class="doc doc-object doc-module">



<a id="thermo.stages.evaluate_model"></a>
  <div class="doc doc-contents first">
  
      <p>This script validates the results of the rest of the
workflow and produces plots and charts so that the quality
can be further evaluated by the user.</p>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h2 id="ref-ml-evaluate-thermo.stages.evaluate_model.extract_coefficients" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">extract_coefficients</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ref-ml-evaluate-__codelineno-0-1"></a><span class="n">extract_coefficients</span><span class="p">(</span><span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">RegressorMixin</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
</span></code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Extracts the cost coefficients for different room from the model.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>dataf</code></td>
          <td>
                <code><span data-autorefs-optional-hover="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The training set.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>model</code></td>
          <td>
                <code><span data-autorefs-optional-hover="sklearn.base.RegressorMixin">RegressorMixin</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Fitted regression model.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span data-autorefs-optional-hover="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>DataFrame with the cost coefficients of the rooms given their status.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>thermo/stages/evaluate_model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-68">68</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-69">69</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-70">70</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-71">71</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-72">72</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-73">73</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-74">74</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-75">75</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-76">76</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-77">77</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-78">78</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-79">79</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-80">80</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-81">81</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-82">82</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-83">83</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-84">84</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-85">85</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-86">86</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-87">87</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-88">88</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="k">def</span> <span class="nf">extract_coefficients</span><span class="p">(</span><span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">RegressorMixin</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">    Extracts the cost coefficients for different room from the model.</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">    Args:</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        dataf: The training set.</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        model: Fitted regression model.</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">    Returns:</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">        DataFrame with the cost coefficients of the rooms given their status.</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dataf</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;booked&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">col</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;day&quot;</span><span class="p">)</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a>    <span class="p">]</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a>    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a>        <span class="p">{</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a>            <span class="s2">&quot;room&quot;</span><span class="p">:</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">names</span><span class="p">),</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a>            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">names</span><span class="p">),</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a>            <span class="s2">&quot;cost&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;regression&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">coef_</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)],</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="p">}</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a>    <span class="p">)</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s2">&quot;room&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s2">&quot;cost&quot;</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="ref-ml-evaluate-thermo.stages.evaluate_model.get_metrics" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">get_metrics</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ref-ml-evaluate-__codelineno-0-1"></a><span class="n">get_metrics</span><span class="p">(</span><span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">nfolds</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">which</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
</span></code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Returns metrics of the best model from grid search results.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>dataf</code></td>
          <td>
                <code><span data-autorefs-optional-hover="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Grid search results.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>nfolds</code></td>
          <td>
                <code><span data-autorefs-optional="int">int</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Number of cross-validation folds in dataf.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>which</code></td>
          <td>
                <code><span data-autorefs-optional="str">str</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The type of metrics to retrieve ("test" or "train").</p>
            </div>
          </td>
          <td>
                <code>&#39;test&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>dict</code></td>          <td>
                <code><span data-autorefs-optional="dict">dict</span>[<span data-autorefs-optional="str">str</span>, <span data-autorefs-optional-hover="typing.Any">Any</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Dictionary containing the metrics.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>thermo/stages/evaluate_model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-21">21</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-22">22</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-23">23</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-24">24</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-25">25</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-26">26</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-27">27</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-28">28</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-29">29</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-30">30</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-31">31</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-32">32</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-33">33</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-34">34</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-35">35</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-36">36</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-37">37</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-38">38</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-39">39</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-40">40</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-41">41</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-42">42</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-43">43</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-44">44</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-45">45</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-46">46</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="k">def</span> <span class="nf">get_metrics</span><span class="p">(</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a>    <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">nfolds</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">which</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">    Returns metrics of the best model from grid search results.</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">    Args:</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">        dataf: Grid search results.</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">        nfolds: Number of cross-validation folds in dataf.</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">        which: The type of metrics to retrieve (&quot;test&quot; or &quot;train&quot;).</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">        Defaults to &quot;test&quot;.</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    Returns:</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">        dict: Dictionary containing the metrics.</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="n">idx</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="s2">&quot;mean_test_r2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="n">best_model</span> <span class="o">=</span> <span class="n">dataf</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a>        <span class="s2">&quot;r2&quot;</span><span class="p">:</span> <span class="n">best_model</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;mean_</span><span class="si">{</span><span class="n">which</span><span class="si">}</span><span class="s2">_r2&quot;</span><span class="p">],</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a>        <span class="s2">&quot;r2_err&quot;</span><span class="p">:</span> <span class="n">best_model</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;std_</span><span class="si">{</span><span class="n">which</span><span class="si">}</span><span class="s2">_r2&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">nfolds</span><span class="p">),</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a>        <span class="s2">&quot;rmse&quot;</span><span class="p">:</span> <span class="o">-</span><span class="n">best_model</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;mean_</span><span class="si">{</span><span class="n">which</span><span class="si">}</span><span class="s2">_neg_root_mean_squared_error&quot;</span><span class="p">],</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a>        <span class="s2">&quot;rmse_err&quot;</span><span class="p">:</span> <span class="n">best_model</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;std_</span><span class="si">{</span><span class="n">which</span><span class="si">}</span><span class="s2">_neg_root_mean_squared_error&quot;</span><span class="p">]</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a>        <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">nfolds</span><span class="p">),</span>  <span class="c1"># noqa W503</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a>    <span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="ref-ml-evaluate-thermo.stages.evaluate_model.plot_error_distribution" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">plot_error_distribution</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ref-ml-evaluate-__codelineno-0-1"></a><span class="n">plot_error_distribution</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">RegressorMixin</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">figpath</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</span></code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Creates the scatter plot showing the relationship between
the true and predicted values.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>model</code></td>
          <td>
                <code><span data-autorefs-optional-hover="sklearn.base.RegressorMixin">RegressorMixin</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Fitted regression model.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>dataf</code></td>
          <td>
                <code><span data-autorefs-optional-hover="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>training set.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>target</code></td>
          <td>
                <code><span data-autorefs-optional="str">str</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Name of the target column.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>figpath</code></td>
          <td>
                <code><span data-autorefs-optional-hover="pathlib.Path">Path</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Filepath to save the plot.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>thermo/stages/evaluate_model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-100">100</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-101">101</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-102">102</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-103">103</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-104">104</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-105">105</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-106">106</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-107">107</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-108">108</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-109">109</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-110">110</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-111">111</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-112">112</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-113">113</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-114">114</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-115">115</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-116">116</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="k">def</span> <span class="nf">plot_error_distribution</span><span class="p">(</span>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a>    <span class="n">model</span><span class="p">:</span> <span class="n">RegressorMixin</span><span class="p">,</span> <span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">figpath</span><span class="p">:</span> <span class="n">Path</span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">    Creates the scatter plot showing the relationship between</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">    the true and predicted values.</span>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">    Args:</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">        model: Fitted regression model.</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">        dataf: training set.</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">        target: Name of the target column.</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">        figpath: Filepath to save the plot.</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="n">y_true</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">target</span><span class="p">]</span>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="n">X</span> <span class="o">=</span> <span class="n">dataf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">target</span><span class="p">)</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a>    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">y_true</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">y_pred</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">y_pred</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a>    <span class="n">fig</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">jointplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_true</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a>    <span class="n">fig</span><span class="o">.</span><span class="n">ax_joint</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="s2">&quot;k-&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="n">fig</span><span class="o">.</span><span class="n">ax_joint</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="n">rmse</span><span class="p">,</span> <span class="s2">&quot;k--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="n">fig</span><span class="o">.</span><span class="n">ax_joint</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="n">rmse</span><span class="p">,</span> <span class="s2">&quot;k--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="n">fig</span><span class="o">.</span><span class="n">ax_joint</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;prediction (kWh)&quot;</span><span class="p">)</span>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="n">fig</span><span class="o">.</span><span class="n">ax_joint</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;consumption (kWh)&quot;</span><span class="p">)</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figpath</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="ref-ml-evaluate-thermo.stages.evaluate_model.plot_gridsearch" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">plot_gridsearch</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ref-ml-evaluate-__codelineno-0-1"></a><span class="n">plot_gridsearch</span><span class="p">(</span><span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">nfolds</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">figpath</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</span></code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Plots the results of the grid search for the L2 regularization.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>dataf</code></td>
          <td>
                <code><span data-autorefs-optional-hover="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Grid search results.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>nfolds</code></td>
          <td>
                <code><span data-autorefs-optional="int">int</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Number of cross-validation folds in dataf.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>figpath</code></td>
          <td>
                <code><span data-autorefs-optional-hover="pathlib.Path">Path</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Filepath to save the plot.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>thermo/stages/evaluate_model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-49">49</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-50">50</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-51">51</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-52">52</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-53">53</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-54">54</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-55">55</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-56">56</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-57">57</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-58">58</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-59">59</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-60">60</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-61">61</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-62">62</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-63">63</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-64">64</a></span>
<span class="normal"><a href="#ref-ml-evaluate-__codelineno-0-65">65</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="k">def</span> <span class="nf">plot_gridsearch</span><span class="p">(</span><span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">nfolds</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">figpath</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Plots the results of the grid search for the L2 regularization.</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">    Args:</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">        dataf: Grid search results.</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">        nfolds: Number of cross-validation folds in dataf.</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">        figpath: Filepath to save the plot.</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="s2">&quot;param_regression__alpha&quot;</span><span class="p">]</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a>    <span class="n">y</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="s2">&quot;mean_test_r2&quot;</span><span class="p">]</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="n">y_err</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="s2">&quot;std_test_r2&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">nfolds</span><span class="p">)</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">y_err</span><span class="p">)</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;r2 score&quot;</span><span class="p">)</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;L2 regularization&quot;</span><span class="p">)</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Grid search on the test set&quot;</span><span class="p">)</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figpath</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div></section><h1 class='nav-section-title-end'>Ended: Machine Learning workflow</h1><h1 class='nav-section-title-end'>Ended: Reference</h1></div>





                

              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "/", "features": [], "search": "../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
        <script src="../js/print-site.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
    
  </body>
</html>